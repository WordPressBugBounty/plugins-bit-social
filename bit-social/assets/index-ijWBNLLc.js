import{q as J,v as Q,w as $,a2 as W,a3 as X,r as C,D as Y,E as U,z as a,y as u,j as s,B as S,L as j,S as w,M as Z,F as R,A as ee,a4 as te,T as V,a5 as B,a6 as ae}from"./main-public-sites-jump.js";import{C as se}from"./CronWarning-BMnYSUEx.js";import{D as le,R as oe,F as re}from"./Refresh-Bya20hZW.js";import{u as ne}from"./useSchedules-CrrYQD73.js";import{F,P as ce}from"./index-C-W4kNMW.js";import{D as ie}from"./index-LlP0ihel.js";import{S as N}from"./index-CWY2IUMR.js";import{T as v}from"./index-fH3u09e3.js";import{s as he}from"./index-5orLwp5p.js";import{F as G}from"./index-CJ4TFQWw.js";import{A as ue}from"./index-hU6IeiOA.js";import"./addEventListener-C6h6FZBS.js";import"./index-zK5J05PG.js";import"./index-ucCoCo3p.js";import"./collapse-BbEVqHco.js";import"./index-DKFQcDW_.js";import"./index-BqtIGWYD.js";import"./LeftOutlined-Do7yfEeU.js";import"./Dropdown-dq36a2VS.js";import"./index-CKcAhrXb.js";import"./EllipsisOutlined-DFg8-Wlm.js";import"./move-ogQKQ3g3.js";import"./index-DN6kpQXs.js";import"./row-COoX8Cws.js";import"./EyeOutlined-lxmibuMq.js";import"./context-B3U-QLcK.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function de(e,t){const n=J(),{isPending:o,mutateAsync:l}=Q({mutationFn:async c=>$("logs/destroy/batch",{logIds:c},void 0,"POST"),onSuccess:()=>{n.invalidateQueries({queryKey:["logs",[t,e]]})}});return{deleteLogs:c=>l(c),isLogsDeleting:o}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function ge(e,t,n){const{data:o,isFetched:l,isFetching:c,isLoading:i,refetch:g}=W({enabled:!!t&&!!e,placeholderData:X,queryFn:async()=>$(`logs/${e}/${t}`,void 0,{...n},"GET"),queryKey:["logs",[e,t]],refetchInterval:3e3}),{current_page:m,current_total:T,data:f,pages:A,per_page:x,total:p}=(o==null?void 0:o.data)||{};return{currentPage:m,currentTotal:T,isFetched:l,isFetching:c,isLogsLoading:i,logData:f||[],perPage:x,refetch:g,totalLogs:p,totalPages:A}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function pe(){const e=J(),{data:t,isPending:n,mutateAsync:o}=Q({mutationFn:async l=>$("retry",{...l},void 0,"POST"),onSuccess:()=>{e.invalidateQueries({queryKey:["logs"]})}});return{isRetryLoading:n,result:t,retry:l=>o(l)}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const me=(e,t)=>{const n=Object.keys(e),o=Object.keys(t);return n.length!==o.length?!1:n.every(l=>e[l]===t[l])};function fe({filters:e,setFilters:t}){const[n,o]=C.useState(!1),[l,c]=C.useState(e),[i,g]=C.useState(),{schedules:m}=ne(),{isProClient:T}=Y(U),f=()=>{o(!0)},A=()=>{t({...l}),o(!1)},x=()=>{c(e),o(!1)},p=(h,P)=>{c(k=>({...k,[h]:P}))},I=[{label:a("All"),value:"all"},{label:a("Facebook"),value:"facebook"},{label:a("Linkedin"),value:"linkedin"}],O=[{label:a("Google Business Profile"),value:"googleBusinessProfile"},{label:a("Pinterest"),value:"pinterest"},{label:a("Discord"),value:"discord"},{label:a("Tumblr"),value:"tumblr"},{label:a("X (twitter)"),value:"twitter"},{label:a("Instagram"),value:"instagram"}],D=T?[...I,...O]:I,y=m==null?void 0:m.map(h=>({label:h.name,value:String(h.id)})),M=[{label:a("All"),value:"all"},...y],L=h=>(P,k)=>{if(Array.isArray(k)&&k.every(E=>E===""))return p(h,"all");g(P),p(h,JSON.stringify(k))},_=()=>{g(void 0),c({...q})},z=me(q,l)?"Ok":"Filter";return u(R,{children:[s(w,{children:s(S,{icon:s(j,{name:"filter",size:12}),onClick:f,size:"large",children:a("Filter")})}),s(Z,{footer:[s(S,{onClick:_,children:a("Reset")},"reset"),s(S,{onClick:A,type:"primary",children:z},"ok")],maskClosable:!1,onCancel:x,onOk:A,open:n,title:a("Logs filter"),width:600,children:u(F,{layout:"vertical",children:[s(F.Item,{label:a("Date"),children:s(ie.RangePicker,{className:"w-100",onChange:L("date"),value:i})}),s(F.Item,{label:a("Status"),children:s(N,{defaultValue:"all",onChange:h=>p("status",h),options:[{label:a("All"),value:"all"},{label:a("Success"),value:"1"},{label:a("Error"),value:"2"}],value:l.status})}),s(F.Item,{label:a("Schedule"),children:s(N,{defaultValue:"all",onChange:h=>p("schedule",h),options:M,value:l.schedule})}),s(F.Item,{label:a("Platform"),children:s(N,{defaultValue:"all",onChange:h=>p("platform",h),options:D,value:l.platform})})]})})]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const K={1:"success",2:"error"};function ye({filters:e}){const{platform:t,schedule:n,status:o}=e,l=e.date==="all"?!1:JSON.parse(e.date);return u(w,{size:"small",children:[a("Filter:"),l&&u(v,{color:"purple",children:[a("Date"),": ",l[0]," ",a("to")," ",l[1]]}),o!=="all"&&u(v,{color:K[o],children:[a("Status"),": ",K[o]]}),n!=="all"&&u(v,{color:"orange",children:[a("Schedule"),": ",n," "]}),t!=="all"&&u(v,{color:"geekblue",children:[a("Platform"),": ",t]})]})}const be="_expandDetails_vflxa_1",Ce={expandDetails:be};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Se=(e,t,n)=>{e.stopPropagation(),n(t)},{Paragraph:Ae,Text:ke}=V,ve=(e,t)=>[{dataIndex:"date",key:"date",title:a("Date"),width:"15%"},{dataIndex:"platform",key:"platform",title:a("Platform")},{dataIndex:"account",key:"account",title:a("Account")},{dataIndex:"schedule",key:"schedule",title:a("Schedule"),width:"20%"},{dataIndex:"details",key:"details",render:(o,{details:l,status:c})=>{const g=JSON.stringify(l);return u(G,{align:"center",children:[c==="1"?s(v,{color:"success",children:a("Success")}):s(v,{color:"error",children:a("Error")}),s(Ae,{copyable:{text:g},ellipsis:!0,style:{marginBottom:0},children:g})]})},title:a("Response"),width:"20%"},{dataIndex:"actions",key:"actions",render:(o,{details:l,key:c,scheduleId:i,status:g})=>s(R,{children:g==="1"?s(S,{href:l==null?void 0:l.post_url,icon:s(j,{name:"external-link",size:13}),size:"small",target:"_blank",children:a("Visit")}):s(S,{danger:!0,disabled:t||!i,icon:s(j,{name:"repeat",size:13}),onClick:m=>Se(m,{details:l,key:c,scheduleId:i},e),size:"small",title:i?a("Retry"):a("Related schedule was deleted"),children:a("Retry")})}),title:a("Actions")}],q={date:"all",platform:"all",schedule:"all",scheduleId:"all",status:"all"},Te=e=>s(ue,{description:s("pre",{className:Ce.expandDetails,children:JSON.stringify(e.details,void 0,2)}),message:e.status==="1"?"Success":"Error",showIcon:!0,type:e.status==="1"?"success":"error"}),xe=({expanded:e,onExpand:t,record:n})=>s(S,{onClick:o=>t(n,o),size:"small",children:e?a("Hide"):a("Details")}),De={expandedRowRender:Te,expandIcon:xe,expandIconAsCell:!0,expandIconColumnIndex:6};function Ze(){const[e,t]=ee({}),n=Number(e.get("page"))||1,o=Number(e.get("limit"))||10,[l,c]=C.useState([]),[i,g]=C.useState(q),{isFetching:m,isLogsLoading:T,logData:f,refetch:A,totalLogs:x,totalPages:p}=ge(n,o,i),{deleteLogs:I,isLogsDeleting:O}=de(o,n),{isRetryLoading:D,result:y,retry:M}=pe(),[L,_]=he.useMessage();C.useEffect(()=>{if(!D&&(y==null?void 0:y.status)==="success")return L.open({content:"Retry call successfully",type:"success"});if(!D&&(y==null?void 0:y.status)==="error")return L.open({content:"Retry call successfully",type:"success"})},[y]);const z=l.length>0,h=f&&(f==null?void 0:f.map(r=>{var b;return{account:r.details.account_name,date:te(r.created_at,`${B.DATE_FORMAT} ${B.TIME_FORMAT}`),details:r.details,key:r.id,platform:r.platform,schedule:((b=r==null?void 0:r.schedule)==null?void 0:b.name)||`Auto post - Post ID: ${r.details.post_id}`,scheduleId:r.schedule_id,status:r.status}})),P={onSelect:(r,b)=>{if(r){if(b){c(d=>[...d,r.key]);return}c(d=>d.filter(H=>H!==r.key))}},onSelectAll:(r,b)=>{if(r){c(b.map(d=>d==null?void 0:d.key).filter(d=>d!==void 0));return}c([])}},k=async()=>{await I(l),c([])},E=(r,b)=>{t(d=>(d.set("page",String(r)),d.set("limit",String(b)),d))};return C.useEffect(()=>{A(),c([])},[i]),C.useEffect(()=>{!f.length&&p&&n>p&&t(r=>(r.set("page",String(p)),r))},[f,i]),u(R,{children:[u(G,{className:"mb-2",justify:"space-between",children:[u(w,{children:[(T||O)&&s(ae,{}),z?u(R,{children:[s(ke,{children:`Selected ${l.length} items`}),s(ce,{description:a("Are you sure to delete this logs?"),okText:a("Confirm"),onConfirm:k,placement:"right",title:a("Delete Logs"),children:s(S,{danger:!0,icon:s(le,{}),type:"text"})})]}):void 0,Object.values(i).every(r=>r==="all")?void 0:s(ye,{filters:i,setFilters:g})]}),u(w,{children:[u(V.Link,{href:"https://bit-social.com/docs/log/",rel:"noopener noreferrer",strong:!0,style:{fontSize:"18px"},target:"_blank",children:[a("Visit our documentation"),s(j,{name:"move-up-right",style:{transform:"translateY(-2px)"}})]}),s(S,{icon:s(oe,{spin:m}),loading:m,onClick:()=>A(),size:"large",children:a("Refresh")}),s(fe,{filters:i,setFilters:g})]})]}),s(se,{}),s(re,{bordered:!0,className:"mt-1",columns:ve(M,D),dataSource:h,expandable:De,pagination:{current:n,defaultCurrent:1,onChange:E,pageSize:o,showSizeChanger:!0,total:x},rowSelection:P}),_]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};export{Ze as default};
