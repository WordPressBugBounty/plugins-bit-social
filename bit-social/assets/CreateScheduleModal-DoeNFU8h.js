import{r as O,j as a,a as c,A as me,h as Y,F as E,p as H,u as ne,b as ye,c as fe,d as be,L as Ce,g as re,e as ie,n as _e,m as R}from"./main-afraid-ants-sort.js";import{$ as K,T as ve,b as ce,D as Te,u as Ae,t as Se,d as ee,a as we}from"./DatePicker-BZ3Wqgt0.js";import{$ as Pe}from"./_socialTemplates-CRuryL5C.js";import{C as De}from"./CronWarning-BElqp4cS.js";import{u as le,a as ke,b as G}from"./react-query-BAnB2mAm.js";import{u as je}from"./useSocialTemplates-DLinxB78.js";import{r as $,F as Ie,T as W,i as te,j as Fe,t as he,n as C,u as L,y as _,q as Me,v as ue,I as ae,S as N,l as Le,z as Ye,G as xe,B as Q,M as $e}from"./antd-CMhliQbc.js";import{u as Ee}from"./router-yX2GsLRQ.js";import{a as de}from"./css-in-js-5B1lZlTz.js";import{u as He,C as se}from"./groupHelper-PveggK-o.js";import{F as qe,A as Be,u as Ne}from"./useIntervalTypes-DAAt_mng.js";import{u as Oe}from"./usePostTypes-CNLK-mKL.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function ze(e,t,s){const{data:l,isFetching:u,isLoading:g,refetch:m}=le({queryFn:async()=>O(`schedule/${e}${e?"/":""}${t}/${s}`,void 0,void 0,"GET"),queryKey:[`get-schedules-${e}`,[t,s]],refetchInterval:5e3}),{current_page:w,current_total:d,data:k,pages:y,per_page:T,total:P}=(l==null?void 0:l.data)||{};return{currentPage:w,currentTotal:d,isFetchingSchedules:u,isLoadingSchedules:g,perPage:T,refetchSchedules:m,scheduleData:k||[],totalPages:y,totalSchedule:P}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Re({className:e,size:t="1em",stroke:s=2}){return a(me,{children:c("svg",{className:`svgIcn ${e}`,fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:s,viewBox:"0 0 24 24",width:t,children:[a("line",{x1:"12",x2:"12",y1:"5",y2:"19"}),a("line",{x1:"5",x2:"19",y1:"12",y2:"12"})]})})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Ke(){const e=ke(),{isPending:t,mutateAsync:s}=G({mutationFn:async l=>O("schedule",{...l},void 0,"POST"),onSuccess:()=>{e.invalidateQueries({queryKey:["all-schedules"]}),e.invalidateQueries({queryKey:["get-calendar-schedules"]})}});return{createSchedule:l=>s(l),createScheduleLoading:t}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function We(){const{isPending:e,mutateAsync:t}=G({mutationFn:async s=>{if(!s.id)throw new Error("Schedule ID is undefined");return O(`schedule/${s.id}/update`,{...s},void 0,"POST")}});return{isUpdateScheduleLoading:e,updateSchedule:s=>t(s)}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Ue(){const[e,t]=Y(K),{accounts:s}=He(),l=u=>{t(g=>H(g,m=>{m.accounts={accountIds:u.accountIds,groupIds:u==null?void 0:u.groupIds}}))};return $.useEffect(()=>{l(e.accounts)},[]),s.length?c(Fe,{gutter:20,children:[a(te,{span:10,children:c(E,{children:[c(Ie,{className:"mb-1",justify:"space-between",children:[a(W.Title,{level:5,children:"Accounts"}),a(se,{})]}),a(qe,{selectedAccount:e.accounts,setSelectedAccount:l})]})}),a(te,{span:14,children:a(ve,{})})]}):c(E,{children:[a(Be,{iconSize:40,textLevel:4}),a("div",{style:{textAlign:"center"},children:a(se,{})})]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Qe(e){const{data:t,isLoading:s}=le({queryFn:async()=>O("categories",void 0,{postType:e},"GET"),queryKey:["categories",e]});return{categoriesAndTags:t==null?void 0:t.data,isLoadingCategories:s}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Ve(){const{isPending:e,mutateAsync:t}=G({mutationFn:async s=>O("filtered-posts",{...s},void 0,"POST")});return{loadingPostFilter:e,postFilter:s=>t(s)}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const{Title:Ge}=W,Ze=[{label:"All times",value:"0"},{label:"Today",value:"1"},{label:"last 7 days",value:"7"},{label:"last 15 days",value:"15"},{label:"last 30 days",value:"30"},{label:"last 90 days",value:"90"},{label:"last 180 days",value:"180"},{label:"last 365 days",value:"365"},{label:"custom date range",value:"-1"}];function Je(e,t){return t.label.toLowerCase().includes(e.toLowerCase())}const Xe=(e,t)=>((t==null?void 0:t.label)??"").toLowerCase().includes(e.toLowerCase());function et(){const{token:e}=he.useToken(),[t,s]=Y(K),{RangePicker:l}=Me,{loadingPostType:u,postTypes:g}=Oe(),[m,w]=$.useState([]),{loadingPostFilter:d,postFilter:k}=Ve(),{categoriesAndTags:y,isLoadingCategories:T}=Qe(t.post_filters.post_type||""),{isProClient:P}=ne(ye),A=fe(be),x=g&&Object.values(g).map(o=>({label:c(E,{children:[o.label," ",o.name!=="post"&&!P&&a(Ce,{color:"#ff8609",name:"crown",size:16})]}),value:o.name})),j=y?Object.keys(y).map(o=>({label:o,options:y[o].map(r=>({label:r.name,value:r.id}))})):[],i=(o,r)=>{s(D=>H(D,I=>{I.post_filters={...I.post_filters,[o]:r}}))},n=o=>r=>{if(o==="filter_by_days")if(r==="0")i("custom_date_range","");else{const D=_();let I=Number.parseInt(r,10);(r==="-1"||r==="1")&&(I=0);const U=D.subtract(I,"day");i("custom_date_range",[U.format("YYYY-MM-DD"),D.format("YYYY-MM-DD")])}if(!P&&o==="post_type"&&r!=="post"){A(!0);return}i(o,r)},f=o=>(r,D)=>{i("filter_by_days","-1"),i(o,D)},b=o=>{i("specific_postIds",o)},S=async()=>{const o=await k(t.post_filters);w((o==null?void 0:o.data)||[])};return $.useEffect(()=>{S()},[t.post_filters]),c(E,{children:[c(C,{layout:"vertical",children:[c(C.Item,{label:"By the published time of the posts",required:!0,children:[a(L,{onChange:n("filter_by_days"),options:Ze,placeholder:"Select publish date",value:t.post_filters.filter_by_days}),t.post_filters.filter_by_days!=="0"&&t.post_filters.custom_date_range&&a(l,{allowClear:!1,onChange:f("custom_date_range"),style:{marginTop:8},value:[_(t.post_filters.custom_date_range[0],"YYYY-MM-DD"),_(t.post_filters.custom_date_range[1],"YYYY-MM-DD")]})]}),a(C.Item,{label:"By post type",children:a(L,{allowClear:!0,loading:u,onChange:n("post_type"),options:x,placeholder:"Select post type",value:t.post_filters.post_type})}),a(C.Item,{label:"By the post category and tag",children:a(L,{allowClear:!0,filterOption:Xe,loading:T,onChange:n("categories_and_tags"),options:j,placeholder:"Select category or tag",showSearch:!0,value:t.post_filters.categories_and_tags})}),a(C.Item,{label:"Select Specific Post",children:a(L,{allowClear:!0,filterOption:(o,r)=>r?Je(o,r):!1,loading:d,mode:"multiple",onChange:b,options:m,placeholder:"Post ID: Post Title",showSearch:!0,style:{width:"100%"},value:t.post_filters.specific_postIds})})]}),c(Ge,{css:de({backgroundColor:e.colorBgElevated,bottom:0,marginBottom:"0 !important",paddingTop:6,position:"sticky"},"",""),level:5,children:["Posts matched by current filters: ",m==null?void 0:m.length]})]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const{Text:V}=W,{dateFormat:tt,timeFormat:at,timeZone:z}=re(ie),st=`${tt} ${at}`,ot=_e(st),oe=[{label:"Monday",value:"Mon"},{label:"Tuesday",value:"Tue"},{label:"Wednesday",value:"Wed"},{label:"Thursday",value:"Thu"},{label:"Friday",value:"Fri"},{label:"Saturday",value:"Sat"},{label:"Sunday",value:"Sun"}];var nt={name:"z33n32",styles:"max-width:80px"},rt={name:"ypff5m",styles:"min-width:100px"};function it(){var A,x,j;const[e,t]=Y(K),s=Ne(),[l,u]=Y(ce),[g,m]=ue.useMessage(),w=_(R(z)).format("YYYY-MM-DD HH:mm:ss"),d=(i,n)=>{t(f=>H(f,b=>{b.settings={...b.settings,[i]:n}}))},k=i=>n=>{if(n&&_(n).diff(R(z))<1){u(b=>({...b,startedAt:"Start date & time must be grater than local time"}));return}const f=n==null?void 0:n.format("YYYY-MM-DD HH:mm:ss");if(f)return l.startedAt&&u(b=>({...b,startedAt:""})),d(i,f)},y=i=>n=>{if(i==="sleep_days"&&Array.isArray(n)&&oe.length===n.length){g.open({content:"Minimum one day required for post ",type:"warning"});return}d(i,n)},T=i=>{const{name:n,value:f}=i.target;d(n,f)},P=i=>(n,f)=>{if(n===void 0){t(b=>H(b,S=>{delete S.settings.sleep_time}));return}d(i,f)};return c(C,{layout:"vertical",children:[m,a(C.Item,{label:"Title",children:a(ae,{name:"name",onChange:T,placeholder:"Enter a name",type:"text",value:(A=e.settings)==null?void 0:A.name})}),a(C.Item,{label:"Start date & time",children:c(N,{direction:"vertical",children:[a(Te,{onChangeDate:k,stateData:e,type:"SCHEDULE"}),l.startedAt&&c(V,{type:"danger",children:[l.startedAt," "]}),c(V,{mark:!0,children:["Local time: ",_(w).format(ot)," ( ",z,")"]})]})}),a(C.Item,{label:"Post interval",style:{margin:"10px 0"},children:c(N,{children:[a(ae,{css:nt,min:1,name:"post_interval_value",onChange:T,type:"number",value:e.settings.post_interval_value}),a(L,{css:rt,onChange:y("post_interval_type"),options:s,value:e.settings.post_interval_type})]})}),e.id&&e.settings.started_at&&_(e.settings.started_at).diff(R(z))<1&&a(Le,{message:c(E,{children:["If your start time has passed, updating the interval will set your next post to local time plus the new interval! For example, current time 06:00 PM, updated Post interval: 2 hours. Next post will be at 08:00 PM."," ",a(W.Link,{href:"https://bit-social.com/docs/bit-social/schedule-wordpress-posts-on-social-media/#if-you-update-your-post-interval",rel:"noopener noreferrer",target:"_blank",underline:!0,children:"Visit our documentation"})]}),showIcon:!0,type:"info"}),a(C.Item,{label:"Order posts by",children:a(L,{onChange:y("post_publish_order"),options:[{label:"Randomly without duplicates",value:"1"},{label:"Randomly",value:"2"},{label:"Start from the oldest to new posts",value:"3"},{label:"Start from the latest to old posts",value:"4"}],value:e.settings.post_publish_order})}),a(C.Item,{children:c(N,{direction:"vertical",children:[a(N,{children:a(V,{children:"Set a sleep timer "})}),a(Ye.RangePicker,{format:"HH:mm",onChange:P("sleep_time"),order:!1,value:(x=e.settings.sleep_time)!=null&&x[0]&&((j=e.settings.sleep_time)!=null&&j[1])?[_(e.settings.sleep_time[0],"HH:mm"),_(e.settings.sleep_time[1],"HH:mm")]:void 0})]})}),a(C.Item,{label:"Set sleep days",children:a(L,{allowClear:!0,mode:"multiple",onChange:y("sleep_days"),options:oe,placeholder:"Select sleep days",value:e.settings.sleep_days})})]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ct=[{children:a(it,{}),key:"1",label:"Settings"},{children:a(et,{}),key:"2",label:"Post Filter"},{children:a(Ue,{}),key:"3",label:"Accounts & Template"}];function lt({handleTabActive:e,tabActive:t,token:s}){return a("div",{style:{paddingInline:24},children:a(xe,{activeKey:t,className:"sticky-tab",css:de({"& .ant-tabs-nav":{backgroundColor:s.colorBgElevated}},"",""),defaultActiveKey:"1",items:ct,onChange:e})})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};_.extend(Ae);_.extend(Se);const{timeZone:ht}=re(ie);function At({btnTitle:e,isScheduleModalOpen:t,setIsScheduleModalOpen:s}){const{token:l}=he.useToken(),[u,g]=Y(K),m=$.useId(),[w,d]=$.useState("1"),{createSchedule:k,createScheduleLoading:y}=Ke(),{isUpdateScheduleLoading:T,updateSchedule:P}=We(),[A,x]=ue.useMessage(),[j]=Ee(),i=Number(j.get("page"))||1,n=Number(j.get("limit"))||10,[f]=Y(we),{refetchSchedules:b}=ze(f,i,n),{socialTemplates:S}=je(),o=ne(Pe),[r,D]=Y(ce);$.useEffect(()=>{!S||t.type!=="Create"||g(v=>H(v,F=>{Object.keys(F.templates).forEach(M=>{const h=S==null?void 0:S[M],p=F.templates[M],J=Object.keys(p).filter(B=>B!=="content"&&B!=="button"),X=h==null?void 0:h.postingType;p.content=(h==null?void 0:h.content)||"",J.forEach(B=>{B in p&&(p[B]=!1)}),"comment"in p&&h&&"comment"in h&&(p.comment=h.comment||""),M==="googleBusinessProfile"&&"button"in p&&h&&"button"in h&&(p.button=h.button||"none"),M==="pinterest"&&"isLinkCard"in p&&h&&"isLinkCard"in h&&(p.isLinkCard=h.isLinkCard),J.includes(X)&&(p[X]=!0)})}))},[S,t.open]);const I=(v,F)=>{var q,M,h,p;return v.settings.name===""?(A.open({content:"name required",type:"error"}),!1):v.settings.started_at===""?(A.open({content:"start time required",type:"error"}),!1):!((q=v.accounts.accountIds)!=null&&q.length)&&!((h=(M=v.accounts)==null?void 0:M.groupIds)!=null&&h.length)?(A.open({content:"No account selected",type:"error"}),F("3"),!1):(p=r==null?void 0:r.startedAt)!=null&&p.length?(A.open({content:r.startedAt,type:"error"}),F("1"),!1):!0},U=()=>{d("1");const v=_(R(ht)).format("YYYY-MM-DD HH:mm:ss");g(F=>H(F,q=>{q.settings.started_at=v})),s({open:!0,type:"Create"})},pe=async()=>{I(u,d)&&(await(u.id?P(u):k(u)),b(),s({open:!1,type:"Close"}),d("1"),g(ee(o)))},Z=()=>{d("1"),s({open:!1,type:"Close"}),D({}),g(ee(o))},ge=v=>{d(v)};return c(E,{children:[x,e&&a(Q,{icon:a(Re,{size:12}),onClick:U,size:"large",type:"primary",children:e}),a($e,{centered:!0,confirmLoading:y||T,footer:c(N,{children:[a("div",{className:"pr-2",children:a(De,{type:"message"})}),a(Q,{onClick:Z,children:"Cancel"},"back"),a(Q,{loading:y||T,onClick:pe,type:"primary",children:u.id?"Update":"Create"},"Ok")]}),maskClosable:!1,onCancel:Z,open:t.open,styles:{body:{marginInline:-24,maxHeight:"calc(100vh - 160px)",overflow:"auto"}},title:`${t==null?void 0:t.type} schedule`,width:w==="3"?800:600,children:a(lt,{handleTabActive:ge,tabActive:w,token:l})},`hello ${m}`)]})}export{At as C,ze as u};
