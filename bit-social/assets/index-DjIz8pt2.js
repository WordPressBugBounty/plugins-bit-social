import{f as Ke,r as ne,g as Le,e as De,c as qe,k as Se,l as ae,m as Z,a as p,j as a,F as B,L as z,h as X,u as ge,b as me,p as P,n as Ge}from"./main-afraid-ants-sort.js";import{r as R,s as fe,y as U,j as Me,S as H,T as Q,P as we,B as j,i as ie,w as Je,E as Ze,m as Xe,p as de,u as pe,H as Te,J as ee,n as D,I as K,U as Fe,h as Ee,g as et,l as tt,z as at,M as Ue,v as st,F as ke,G as it,K as nt}from"./antd-CMhliQbc.js";import{C as He}from"./CronWarning-BElqp4cS.js";import{u as ot,N as ct}from"./useUpdateScheduleStatus-DLEkdW5O.js";import{D as rt,R as lt}from"./Refresh-C564NUp4.js";import{u as Re}from"./router-yX2GsLRQ.js";import{a as Be,b as be,u as ht,k as dt,Q as ut}from"./react-query-BAnB2mAm.js";import{P as pt}from"./PlatformIcon-DHlKQsTj.js";import{u as gt,a as mt,g as ft,C as Ae}from"./groupHelper-PveggK-o.js";import{u as bt,F as Ct,A as yt}from"./useIntervalTypes-DAAt_mng.js";import{b as St,D as wt,g as Tt}from"./DatePicker-BZ3Wqgt0.js";import{p as ve}from"./TemplateDocLink-DOw8aIDd.js";import"./ProGoogleBusinessProfileSettings-0JppJ8Az.js";import"./css-in-js-5B1lZlTz.js";import"./_socialTemplates-CRuryL5C.js";import"./index-Bxjp1ha4.js";import"./useMemoDebounce-DLzpEz7x.js";import"./useUpdateSocialTemplates-BduuTD5H.js";import"./PreviewDummy-CZePD3yE.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const $e=()=>({accounts:{accountIds:[],groupIds:[]},platforms:[],settings:{name:"",post_interval_type:"hour",post_interval_value:1,repeat:!1,started_at:void 0},templates:{all:{content:"",isLinkCard:!1,link:"",media:[]},discord:{content:"",edit:!1,isAllImages:!1,isLinkCard:!1,link:"",media:[]},facebook:{content:"",edit:!1,isAllImages:!1,isLinkCard:!1,link:"",media:[]},googleBusinessProfile:{button:"none",content:"",edit:!1,isAllImages:!1,isLinkCard:!1,link:"",media:[]},instagram:{comment:"",content:"",edit:!1,isAllImages:!0,media:[]},linkedin:{content:"",edit:!1,isAllImages:!1,isLinkCard:!1,link:"",media:[]},pinterest:{content:"",edit:!1,isAllImages:!1,isLinkCard:!1,link:"",media:[]},tumblr:{content:"",edit:!1,isAllImages:!1,isLinkCard:!1,link:"",media:[]},twitter:{content:"",edit:!1,isAllImages:!1,isLinkCard:!1,link:"",media:[]}}}),q=globalThis.jotaiAtomCache.get("/home/runner/work/bit-social/bit-social/frontend/src/common/globalStates/$shareNowData.ts/$shareNowData",Ke($e()));q.debugLabel="$shareNowData";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function kt(e,t){const l=Be(),{isPending:s,mutateAsync:T}=be({mutationFn:async N=>ne("share-now/destroy/batch",{shareNowIds:N},void 0,"POST"),onSuccess:()=>{l.invalidateQueries({queryKey:["share-now",[t,e]]})}});return{deleteShareNow:N=>T(N),isShareNowDeleting:s}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Oe(e,t){const{data:l,isFetching:s,isLoading:T,refetch:N}=ht({enabled:!!t&&!!e,placeholderData:dt,queryFn:async()=>ne(`share-now/${e}/${t}`,void 0,void 0,"GET"),queryKey:["share-now",[e,t]],refetchInterval:5e3}),{current_page:d,current_total:C,data:x,pages:k,per_page:o,total:I}=(l==null?void 0:l.data)||{};return{currentPage:d,currentTotal:C,isFetchingShareNowList:s,isLoadingShareNowList:T,perPage:o,refetchShareNowList:N,shareNowData:x||[],totalPages:k,totalShareNow:I}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const At=({token:e})=>({background:e.colorSuccessBg,border:`1px solid ${e.colorSuccessBorder}`,borderRadius:"10px",color:e.colorSuccessText,minWidth:"90px"}),vt=({token:e})=>({background:e.colorWarningBg,border:`1px solid ${e.colorWarningBorder}`,borderRadius:"10px",color:e.colorWarningText,minWidth:"90px"}),ue=0,G=1,xe=2,xt=3,It=4;function Nt({setShareNowModal:e}){const[t,l]=Re({}),s=Number(t.get("page"))||1,T=Number(t.get("limit"))||10,{timeZone:N}=Le(De),{isFetchingShareNowList:d,isLoadingShareNowList:C,refetchShareNowList:x,shareNowData:k,totalPages:o,totalShareNow:I}=Oe(s,T),[c,n]=R.useState([]),{updateScheduleStatus:m}=ot(),{deleteShareNow:h,isShareNowDeleting:y}=kt(T,s),_=qe(q),[M,V]=fe.useNotification(),f=(i,b="success")=>{M[b]({description:i,message:"Share Now"})},r=k.map(i=>({created_at:Se(i.created_at,`${ae.DATE_FORMAT} ${ae.TIME_FORMAT}`),interval:i.config,key:i.id,nextPost:i.next_published_at&&i.status===1&&U(i.next_published_at).diff(Z(N))>1?i.human_readable_next_publish:"-",start:i!=null&&i.config.settings.started_at?Se(i==null?void 0:i.config.settings.started_at,`${ae.DATE_FORMAT} ${ae.TIME_FORMAT}`):"-",status:i.status,title:i.name})),A=async(i,b)=>{const{data:u,status:Y}=await m({id:i,status:b});f(u,Y),x()},L=()=>{_($e()),e({open:!0,type:"create"})},$=async i=>{await h([i]),x()},W=i=>{const b=k.find(u=>u.id===i);b&&(_(u=>({...u,accounts:b.config.accounts,id:i,settings:b.config.settings,status:b.status,templates:b.config.templates})),e({open:!0,type:"edit"}))},F=[{dataIndex:"title",key:"title",title:"Title",width:"20%"},{dataIndex:"created_at",key:"created_at",title:"Created At"},{dataIndex:"start",key:"start",title:"Start Scheduled Post"},{dataIndex:"interval",key:"interval",render:(i,{interval:b})=>a(Q.Text,{children:b.settings.repeat?`${b.settings.post_interval_value} ${b.settings.post_interval_type}`:"-"}),title:"Interval "},{dataIndex:"nextPost",key:"nextPost",title:"Next Post "},{dataIndex:"status",key:"status",render:(i,{key:b,status:u})=>{switch(u){case G:case ue:return a(pe,{css:u===G?At:vt,onChange:Y=>A(b,Number(Y)),options:[{disabled:u===G,label:"Active",value:G},{disabled:u===ue,label:"Paused",value:ue}],size:"small",value:u===G?"Active":"Paused",variant:"borderless"});case xe:return a(de,{color:"grey",children:"Completed"});case xt:return a(de,{color:"purple",children:"Draft"});case It:return a(de,{color:"red",children:"Missed"})}},title:"Status"},{dataIndex:"action",key:"action",render:(i,{key:b,status:u})=>p(H,{direction:"horizontal",children:[u!==xe&&a(j,{icon:a(z,{name:"pencil"}),onClick:()=>W(b),type:"text"}),a(we,{description:"Are you sure you want to delete this schedule?",okButtonProps:{danger:!0,loading:y},okText:"Yes, Delete",onConfirm:()=>$(b),placement:"right",title:"Delete?",children:a(j,{danger:!0,icon:a(z,{name:"trash-2"}),type:"text"})})]}),title:"Action "}],oe=(i,b)=>{l(u=>(u.set("page",String(i)),u.set("limit",String(b)),u))},ce={onSelect:(i,b)=>{if(i){if(b){n(u=>[...u,i.key]);return}n(u=>u.filter(Y=>Y!==i.key))}},onSelectAll:(i,b)=>{if(i){n(b.map(u=>u==null?void 0:u.key).filter(u=>u!==void 0));return}n([])}},te=c.length>0,re=async()=>{await h(c),n([]),x()};return R.useEffect(()=>{!k.length&&o&&s>o&&l(i=>(i.set("page",String(o)),i))},[k]),p(B,{children:[V,p(Me,{className:"mb-2",justify:"space-between",children:[a(ie,{children:a(H,{children:te?p(B,{children:[a(Q.Text,{children:`Selected ${c.length} items`}),a(we,{description:"Are you sure to delete this logs?",okText:"Confirm",onConfirm:re,placement:"right",title:"Delete Logs",children:a(j,{danger:!0,icon:a(rt,{}),type:"text"})})]}):void 0})}),a(ie,{children:r!=null&&r.length?p(H,{children:[p(Q.Link,{href:"https://bit-social.com/docs/instantly-share-posts-on-social-media-platforms/",rel:"noopener noreferrer",strong:!0,style:{fontSize:"18px"},target:"_blank",children:["How to share a post instantly"," ",a(z,{name:"move-up-right",style:{transform:"translateY(-2px)"}})]}),a(j,{disabled:C||d,icon:a(lt,{spin:C||d}),onClick:()=>x(),size:"large",children:"Refresh"}),a(j,{icon:a(z,{name:"plus"}),onClick:L,size:"large",type:"primary",children:"Share Post"})]}):void 0})]}),r!=null&&r.length?p(B,{children:[a(He,{}),a(Je,{bordered:!0,className:"mt-1",columns:F,dataSource:r,pagination:{current:s,defaultCurrent:1,onChange:oe,pageSize:T,showSizeChanger:!0,total:I},rowSelection:ce})]}):void 0,!C&&!(r!=null&&r.length)?a(Ze,{description:"No Share Post found!",children:a(j,{icon:a(z,{name:"plus"}),onClick:L,size:"large",type:"primary",children:"Share Post"})}):void 0,C&&a(Xe,{}),!C&&!(r!=null&&r.length)?a(ct,{fontSize:"1.6rem",section:"shareNow",style:{marginTop:"30px",textAlign:"justify"}}):void 0]})}const _t=""+new URL("bit-social-ba-assets-458.svg",import.meta.url).href;globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function jt(){const e=new ut,{isPending:t,isSuccess:l,mutateAsync:s}=be({mutationFn:async T=>ne("share-now",{...T},void 0,"POST"),onSuccess:()=>{e.invalidateQueries({queryKey:["all-schedules"]}),e.invalidateQueries({queryKey:["get-calendar-schedules"]}),e.invalidateQueries({queryKey:["share-now"]})}});return{createShareNow:s,isCreateShareNowLoading:t,isShareNowSuccess:l}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Pt(){const e=Be(),{isPending:t,mutateAsync:l}=be({mutationFn:async s=>ne(`share-now/${s.id}/update`,{...s},void 0,"POST"),onSuccess:()=>{e.invalidateQueries({queryKey:["share-now",[1,10]]})}});return{isUpdateShareNowLoading:t,updateShareNow:l}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Ie=e=>{for(const t in e)if(e.hasOwnProperty(t)){const l=e[t];if(l.text||l.media.length)return!0}return!1};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ze=e=>({name:e.filename,uid:e.id,url:e.url});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function We({handleCheckBox:e,templateData:t,type:l}){return p(B,{children:[l.includes("isLinkCard")&&a(ee,{title:"Enable to the link shared as a card",children:a(Te,{checked:t.isLinkCard,onChange:s=>{e("isLinkCard",s.target.checked)},children:"Link"})}),l.includes("isAllImages")&&a(ee,{title:"Enable to selected image shared",children:a(Te,{checked:t.isAllImages,onChange:s=>{e("isAllImages",s.target.checked)},children:"Media"})})]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Lt=3e3;function Dt(){var k,o,I;const[e,t]=X(q),{isProClient:l}=ge(me),s=["isLinkCard","isAllImages"],T=c=>{t(n=>P(n,m=>{m.templates.facebook.content=c.target.value}))},N=(c,n)=>{t(m=>P(m,h=>{h.templates.facebook.isLinkCard=!1,h.templates.facebook.isAllImages=!1,h.templates.facebook[c]=n}))},d=c=>{const{value:n}=c.target;t(m=>P(m,h=>{h.templates.facebook.link=n}))},C=({fileList:c})=>{const n=P(e,m=>{m.templates.facebook.media=c});t(n)},x=()=>{const c=["image/jpg","image/jpeg","image/png","image/webp"];if(typeof wp<"u"&&wp.media){const n=wp.media({button:{text:"Select Image"},library:{type:c},multiple:l?"add":!1,title:"Media"}),m=e.templates.facebook.media.map(h=>h.uid);n.on("open",()=>{const h=n.state().get("selection");m.forEach(y=>{const _=wp.media.attachment(y);_.fetch().done(()=>{h.add(_)})})}),n.on("select",()=>{const h=n.state().get("selection").toJSON();let y=[];y=h.map(M=>ze(M));const _=y.at(-1)||{};C({file:_,fileList:y})}),n.open()}};return a(Ee,{children:p(D,{layout:"vertical",children:[a(D.Item,{htmlFor:"textBox",label:"Post",children:a(K.TextArea,{id:"textBox",maxLength:Lt,onChange:c=>T(c),placeholder:"Write your custom post",showCount:!0,style:{height:120,resize:"none"},value:e.templates.facebook.content})}),a(H,{className:"py-2",children:a(We,{handleCheckBox:N,templateData:e.templates.facebook,type:s})}),((k=e.templates.facebook)==null?void 0:k.isLinkCard)&&a(D.Item,{htmlFor:"link",label:"Link",children:a(K,{id:"link",onChange:c=>d(c),placeholder:"https://example.com",value:e.templates.facebook.link})}),!((o=e.templates.facebook)!=null&&o.isLinkCard)&&((I=e.templates.facebook)==null?void 0:I.isAllImages)&&a(Fe,{fileList:e.templates.facebook.media,listType:"picture-card",onChange:C,openFileDialogOnClick:!1,children:a(ee,{placement:"right",title:"Add Image",children:a(j,{onClick:x,style:{height:"100%",width:"100%"},children:p(H,{direction:"vertical",children:[a(z,{name:"upload",size:20}),"Upload"]})})})})]})})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Mt=3e3;function Ft(){var k,o,I;const[e,t]=X(q),{isProClient:l}=ge(me),s=["isLinkCard","isAllImages"],T=c=>{t(n=>P(n,m=>{m.templates.linkedin.content=c.target.value}))},N=(c,n)=>{t(m=>P(m,h=>{h.templates.linkedin.isLinkCard=!1,h.templates.linkedin.isAllImages=!1,h.templates.linkedin[c]=n}))},d=c=>{const{value:n}=c.target;t(m=>P(m,h=>{h.templates.linkedin.link=n}))},C=({fileList:c})=>{const n=P(e,m=>{m.templates.linkedin.media=c});t(n)},x=()=>{const c=["image/jpg","image/jpeg","image/png","image/webp"];if(typeof wp<"u"&&wp.media){const n=wp.media({button:{text:"Select Image"},library:{type:c},multiple:l?"add":!1,title:"Media"}),m=e.templates.linkedin.media.map(h=>h.uid);n.on("open",()=>{const h=n.state().get("selection");m.forEach(y=>{const _=wp.media.attachment(y);_.fetch().done(()=>{h.add(_)})})}),n.on("select",()=>{const h=n.state().get("selection").toJSON();let y=[];y=h.map(M=>ze(M));const _=y.at(-1)||{};C({file:_,fileList:y})}),n.open()}};return a(Ee,{children:p(D,{layout:"vertical",children:[a(D.Item,{htmlFor:"textBox",label:"Post",children:a(K.TextArea,{id:"textBox",maxLength:Mt,onChange:c=>T(c),placeholder:"Write your custom post",showCount:!0,style:{height:120,resize:"none"},value:e.templates.linkedin.content})}),a(H,{className:"py-2",children:a(We,{handleCheckBox:N,templateData:e.templates.linkedin,type:s})}),((k=e.templates.linkedin)==null?void 0:k.isLinkCard)&&a(D.Item,{htmlFor:"link",label:"Link",children:a(K,{id:"link",onChange:c=>d(c),placeholder:"https://example.com",value:e.templates.linkedin.link})}),!((o=e.templates.linkedin)!=null&&o.isLinkCard)&&((I=e.templates.linkedin)==null?void 0:I.isAllImages)&&a(Fe,{fileList:e.templates.linkedin.media,listType:"picture-card",onChange:C,openFileDialogOnClick:!1,children:a(ee,{placement:"right",title:"Add Image",children:a(j,{onClick:x,style:{height:"100%",width:"100%"},children:p(H,{direction:"vertical",children:[a(z,{name:"upload",size:20}),"Upload"]})})})})]})})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Et({platform:e}){switch(e){case"facebook":return a(Dt,{});case"linkedin":return a(Ft,{})}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Ut({platform:e}){return a(Et,{platform:e})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Ht=[{label:"Monday",value:"Mon"},{label:"Tuesday",value:"Tue"},{label:"Wednesday",value:"Wed"},{label:"Thursday",value:"Thu"},{label:"Friday",value:"Fri"},{label:"Saturday",value:"Sat"},{label:"Sunday",value:"Sun"}],{dateFormat:Rt,timeFormat:Bt,timeZone:J}=Le(De),$t=`${Rt} ${Bt}`,Ot=Ge($t),{Text:Ne}=Q;var zt={name:"z33n32",styles:"max-width:80px"},Wt={name:"ypff5m",styles:"min-width:100px"};function Yt({isScheduleModal:e,setScheduleModal:t,shareNowModalType:l}){var M,V;const[s,T]=X(q),N=bt(),[d,C]=X(St),{isProClient:x}=ge(me),k=U(Z(J)).format("YYYY-MM-DD HH:mm:ss"),o=(f,r)=>{T(A=>P(A,L=>{L.settings={...L.settings,[f]:r}}))},I=()=>{var f;if((f=d==null?void 0:d.startedAt)!=null&&f.length){fe.error({message:d.startedAt,placement:"topRight"});return}t(!1)},c=f=>r=>{const A=U(Z(J)).format("YYYY-MM-DD"),L=U(r).format("HH:mm:ss");if(!r){C(F=>({...F,startedAt:""})),o(f,"");return}const W=(x?r:U(A+L)).format("YYYY-MM-DD HH:mm:ss");if(r&&U(r).diff(Z(J))<1){C(F=>({...F,startedAt:"Start date & time must be grater than local time"})),o(f,W);return}W&&(C(F=>({...F,startedAt:""})),o(f,W))},n=f=>r=>{o(f,r)},m=f=>{const{name:r,value:A}=f.target;o(r,A)},h=f=>(r,A)=>{if(r===null){T(L=>P(L,$=>{delete $.settings.sleep_time}));return}o(f,A)},y=f=>{var r;f||((r=d==null?void 0:d.startedAt)!=null&&r.length&&C(A=>({...A,startedAt:""})),o("started_at",""))};return a(Ue,{centered:!0,footer:[a(j,{onClick:()=>{var f;T(r=>P(r,A=>{A.settings={...A.settings,post_interval_type:"hour",post_interval_value:1,repeat:!1,started_at:void 0},delete A.settings.sleep_time,delete A.settings.sleep_days})),(f=d==null?void 0:d.startedAt)!=null&&f.length&&C(r=>({...r,startedAt:""}))},children:"Reset"},"reset"),a(j,{onClick:I,type:"primary",children:"Continue"},"continue")],maskClosable:!1,okButtonProps:{style:{display:"none"}},onCancel:I,open:e,title:l==="edit"?"Edit schedule":"Schedule",width:580,children:p(D,{layout:"vertical",children:[a(D.Item,{label:"Start date & time",children:p(H,{direction:"vertical",children:[a(wt,{handleOnClear:y,onChangeDate:c,stateData:s,type:"SHARENOW"}),d.startedAt&&p(Ne,{type:"danger",children:[d.startedAt," "]}),p(Ne,{mark:!0,children:["Local time: ",U(k).format(Ot),"; Time Zone: (",J,")"]})]})}),p(H,{className:"fw-sb pb-2",children:[a(ee,{placement:"bottomLeft",title:"Please, insert a valid start date & time first!",children:a(et,{defaultChecked:s.settings.repeat,disabled:!s.settings.started_at,onChange:f=>o("repeat",f),size:"small",value:s.settings.repeat})}),"Repeat"]}),a(D.Item,{label:"Post interval",style:{margin:"10px 0"},children:p(H,{children:[a(K,{css:zt,disabled:!s.settings.repeat,min:1,name:"post_interval_value",onChange:m,type:"number",value:s.settings.post_interval_value}),a(pe,{css:Wt,disabled:!s.settings.repeat,onChange:n("post_interval_type"),options:N,value:s.settings.post_interval_type})]})}),s.id&&s.settings.started_at&&U(s.settings.started_at).diff(Z(J))<1&&a(tt,{message:p(B,{children:["If your start time has passed, updating the interval will set your next post to local time plus the new interval! For example, current time 06:00 PM, updated Post interval: 2 hours. Next post will be at 08:00 PM."," ",a(Q.Link,{href:"https://bit-social.com/docs/bit-social/instantly-share-posts-on-social-media-platforms/#if-you-update-your-post-interval",rel:"noopener noreferrer",target:"_blank",underline:!0,children:"Visit our documentation"})]}),showIcon:!0,type:"info"}),a(D.Item,{label:"Set a sleep timer",children:a(at.RangePicker,{disabled:!s.settings.repeat,format:"HH:mm",onChange:h("sleep_time"),value:(M=s.settings.sleep_time)!=null&&M[0]&&((V=s.settings.sleep_time)!=null&&V[1])?[U(s.settings.sleep_time[0],"HH:mm"),U(s.settings.sleep_time[1],"HH:mm")]:void 0})}),a(D.Item,{label:"Set sleep days",children:a(pe,{allowClear:!0,disabled:!s.settings.repeat,mode:"multiple",onChange:n("sleep_days"),options:Ht,placeholder:"Select sleep days",value:s.settings.sleep_days})})]})})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const se=(e,t="success")=>{fe[t]({description:e,duration:3,message:"Share Now"})},_e=(e,t)=>{const l=e[t];return!(!e.media.length&&!(l!=null&&l.length))},je=3;function Vt({shareNowModalClose:e,shareNowModalType:t}){var Ce,ye;const[l,s]=R.useState(!1),[T,N]=R.useState(),[d,C]=R.useState({}),[x,k]=R.useState(),[o,I]=X(q),{createShareNow:c,isCreateShareNowLoading:n}=jt(),{isUpdateShareNowLoading:m,updateShareNow:h}=Pt(),{accounts:y}=gt(),{groups:_}=mt(),[M,V]=st.useMessage(),[f]=Re({}),r=Number(f.get("page"))||1,A=Number(f.get("limit"))||10,{refetchShareNowList:L}=Oe(r,A),$=!!Object.keys(d).length||!1,W=()=>{s(!0)},F=R.useMemo(()=>{var O;const g=o.accounts.accountIds,S=ft(_,(O=o.accounts)==null?void 0:O.groupIds),v=[...g,...S],E=Tt(y,v),le=E.map(w=>({children:a(Ut,{platform:w}),key:w,label:a("span",{title:w,children:a(pt,{name:w,size:32})})}));return N(E[0]),I(w=>P(w,he=>{he.platforms=E})),le},[o.accounts.accountIds,(Ce=o.accounts)==null?void 0:Ce.groupIds]),oe=g=>I(S=>P(S,v=>{v.accounts={accountIds:g.accountIds,groupIds:g==null?void 0:g.groupIds}})),ce=(g,S)=>{const v=[],{platforms:E}=g,le=E.length===1;if(g.platforms.length>1&&E.map(O=>{const{requirement:w}=S[O];if(!_e(g.templates[O],w==null?void 0:w.type))return v.push(!0),M.open({content:w==null?void 0:w.message,type:"error"})}),le){const O=E[0],{requirement:w}=S[O];_e(g.templates[O],w==null?void 0:w.type)||(v.push(!0),M.open({content:w==null?void 0:w.message,type:"error"}))}return v.length&&!0||!1},te=g=>{const{name:S}=g.settings;return S===""?(M.open({content:"Title empty",type:"error"}),!0):(d&&Ie(d),!!(ve&&ce(g,ve)))},re=async()=>{if(k("PUBLISH"),te(o)){k(void 0);return}if(Ie(d),t==="edit"){const{data:S,status:v}=await h(o);se(S,v)}else{const{data:S,status:v}=await c(o);L(),se(S,v)}e()},i=g=>{I({...o}),N(g)},b=g=>{const{value:S}=g.target;I(v=>P(v,E=>{E.settings={...E.settings,name:S}}))},u=async()=>{if(k("DRAFT"),te(o)){k(void 0);return}if(t==="edit"){const{data:S,status:v}=await h({...o,isDraft:!0});L(),se(S,v)}else{const{data:S,status:v}=await c({...o,isDraft:!0});L(),se(S,v)}e()},Y=()=>Object.keys(d).map(g=>{const{text:S}=d[g];return p("div",{children:[" ",p("p",{children:[a("b",{children:g}),": ",S]})]},g)}),Ye=()=>a("div",{children:Y()});R.useEffect(()=>()=>{C({})},[]);const Ve=()=>{var g;return t==="edit"&&o.status===je?"Update & Publish":t==="edit"?"Update":(g=o.settings.started_at)!=null&&g.length?"Create":"Publish Now"},Qe=()=>t==="edit"&&o.status===je?"Update draft":"Draft";return p(B,{children:[V,p(Me,{gutter:20,children:[p(ie,{span:7,children:[p(ke,{className:"mb-1",justify:"space-between",children:[a(Q.Title,{level:5,children:"Accounts"}),y.length?a(Ae,{}):""]}),y!=null&&y.length&&o.accounts?a(Ct,{selectedAccount:o.accounts,setSelectedAccount:oe}):p(B,{children:[a(yt,{iconSize:40,textLevel:5}),a("div",{style:{textAlign:"center"},children:a(Ae,{})})]})]}),a(ie,{span:17,children:a("div",{style:{minHeight:"100%"},children:F&&F.length?p(B,{children:[a("div",{children:a(D,{layout:"vertical",children:a(D.Item,{htmlFor:"name",label:"Title",children:a(K,{id:"name",onChange:b,placeholder:`Untitled Share Now
                    `,value:(ye=o.settings)==null?void 0:ye.name})})})}),a(it,{activeKey:T,items:F,onChange:i,size:"small",tabBarGutter:2}),p(ke,{align:"center",className:"mt-3",gap:8,justify:"end",children:[Object.keys(d).length?a(nt,{content:Ye(),defaultOpen:!0,title:"Something went wrong!",trigger:"click",children:a(j,{danger:!0,icon:a(z,{name:"loader-circle"}),type:"primary"})}):"",a("div",{className:"pr-2",children:a(He,{type:"message"})}),a(j,{disabled:$||x==="PUBLISH",loading:x==="DRAFT"&&(n||m),onClick:u,type:"dashed",children:Qe()}),a(j,{disabled:$,onClick:W,children:t==="edit"?"Edit Schedule":"Setup Schedule"}),a(j,{disabled:$||x==="DRAFT",loading:x==="PUBLISH"&&(n||m),onClick:()=>re(),type:"primary",children:Ve()})]})]}):a("img",{alt:"account select",className:"w-100",src:_t})})})]}),l&&a(Yt,{isScheduleModal:l,setScheduleModal:s,shareNowModalType:t})]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Pe={open:!1,type:void 0};function ua(){const[e,t]=R.useState(Pe),l=()=>{t(Pe)};return p(B,{children:[a(Nt,{setShareNowModal:t}),e.open?a(Ue,{centered:!0,footer:!1,maskClosable:!1,onCancel:l,open:e.open,styles:{body:{height:"calc(100vh - 140px)",marginInline:-24,overflow:"auto",padding:0}},title:e.type==="edit"?"Edit Share Now":"Share Now",width:"70%",children:a("div",{style:{paddingInline:24},children:a(Vt,{shareNowModalClose:l,shareNowModalType:e.type})})}):""]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};export{ua as default};
