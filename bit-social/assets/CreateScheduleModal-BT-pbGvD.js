import{a2 as se,w as H,j as a,y as i,a9 as de,q as pe,v as U,W as F,r as L,F as x,T as O,z as s,X as $,x as oe,D as re,E as ge,G as me,H as ye,L as fe,R as ne,U as le,aa as be,a8 as N,S as Y,ab as Ce,A as _e,B as W,M as ve}from"./main-grumpy-snakes-judge.js";import{$ as R,T as Te,b as ie,D as Se,c as Ae,u as we,t as De,d as X,a as Pe}from"./DatePicker-Cen4Nr6t.js";import{$ as Ie}from"./useSocialTemplates-BXlo0UEi.js";import{C as Me}from"./CronWarning-Db6mAlym.js";import{d as C,D as Fe}from"./index-bQ0nfJVu.js";import{c as ce}from"./emotion-react.browser.esm-CcXds07b.js";import{u as je,C as J}from"./groupHelper-D2jhe13n.js";import{F as ke,A as xe,u as Ye}from"./useIntervalTypes-D1GKyOFX.js";import{F as Le}from"./index-w28iyX2z.js";import{C as ee,R as $e}from"./row-vV5a2ekN.js";import{u as He}from"./usePostTypes-CUnNurw5.js";import{F as b}from"./index-Deb_SY8n.js";import{S as M,I as te}from"./index-D1eUlGgi.js";import{s as he}from"./index-Bqthjdoq.js";import{A as Ee}from"./index-Dxhm2q6q.js";import{T as qe}from"./index-CfejJzE9.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Be(e,t,o){const{data:c,isFetching:h,isLoading:p,refetch:g}=se({queryFn:async()=>H(`schedule/${e}${e?"/":""}${t}/${o}`,void 0,void 0,"GET"),queryKey:[`get-schedules-${e}`,[t,o]],refetchInterval:5e3}),{current_page:S,current_total:d,data:D,pages:m,per_page:_,total:A}=(c==null?void 0:c.data)||{};return{currentPage:S,currentTotal:d,isFetchingSchedules:h,isLoadingSchedules:p,perPage:_,refetchSchedules:g,scheduleData:D||[],totalPages:m,totalSchedule:A}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Ne({className:e,size:t="1em",stroke:o=2}){return a(de,{children:i("svg",{className:`svgIcn ${e}`,fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:o,viewBox:"0 0 24 24",width:t,children:[a("line",{x1:"12",x2:"12",y1:"5",y2:"19"}),a("line",{x1:"5",x2:"19",y1:"12",y2:"12"})]})})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Oe(){const e=pe(),{isPending:t,mutateAsync:o}=U({mutationFn:async c=>H("schedule",{...c},void 0,"POST"),onSuccess:()=>{e.invalidateQueries({queryKey:["all-schedules"]}),e.invalidateQueries({queryKey:["get-calendar-schedules"]})}});return{createSchedule:c=>o(c),createScheduleLoading:t}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Re(){const{isPending:e,mutateAsync:t}=U({mutationFn:async o=>{if(!o.id)throw new Error("Schedule ID is undefined");return H(`schedule/${o.id}/update`,{...o},void 0,"POST")}});return{isUpdateScheduleLoading:e,updateSchedule:o=>t(o)}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function ze(){const[e,t]=F(R),{accounts:o}=je(),c=h=>{t(p=>$(p,g=>{g.accounts={accountIds:h.accountIds,groupIds:h==null?void 0:h.groupIds}}))};return L.useEffect(()=>{c(e.accounts)},[]),o.length?i($e,{gutter:20,children:[a(ee,{span:10,children:i(x,{children:[i(Le,{className:"mb-1",justify:"space-between",children:[a(O.Title,{level:5,children:s("Accounts")}),a(J,{})]}),a(ke,{selectedAccount:e.accounts,setSelectedAccount:c})]})}),a(ee,{span:14,children:a(Te,{})})]}):i(x,{children:[a(xe,{iconSize:40,textLevel:4}),a("div",{style:{textAlign:"center"},children:a(J,{})})]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function We(e){const{data:t,isLoading:o}=se({queryFn:async()=>H("categories",void 0,{postType:e},"GET"),queryKey:["categories",e]});return{categoriesAndTags:t==null?void 0:t.data,isLoadingCategories:o}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Ke(){const{isPending:e,mutateAsync:t}=U({mutationFn:async o=>H("filtered-posts",{...o},void 0,"POST")});return{loadingPostFilter:e,postFilter:o=>t(o)}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const{Title:Ue}=O,Qe=[{label:s("All times"),value:"0"},{label:s("Today"),value:"1"},{label:s("last 7 days"),value:"7"},{label:s("last 15 days"),value:"15"},{label:s("last 30 days"),value:"30"},{label:s("last 90 days"),value:"90"},{label:s("last 180 days"),value:"180"},{label:s("last 365 days"),value:"365"},{label:s("custom date range"),value:"-1"}];function Ve(e,t){return t.label.toLowerCase().includes(e.toLowerCase())}const Ze=(e,t)=>((t==null?void 0:t.label)??"").toLowerCase().includes(e.toLowerCase());function Ge(){const{token:e}=oe.useToken(),[t,o]=F(R),{RangePicker:c}=Fe,{loadingPostType:h,postTypes:p}=He(),[g,S]=L.useState([]),{loadingPostFilter:d,postFilter:D}=Ke(),{categoriesAndTags:m,isLoadingCategories:_}=We(t.post_filters.post_type||""),{isProClient:A}=re(ge),v=me(ye),j=p&&Object.values(p).map(r=>({label:i(x,{children:[r.label," ",r.name!=="post"&&!A&&a(fe,{color:"#ff8609",name:"crown",size:16})]}),value:r.name})),P=m?Object.keys(m).map(r=>({label:r,options:m[r].map(u=>({label:u.name,value:u.id}))})):[],l=(r,u)=>{o(w=>$(w,I=>{I.post_filters={...I.post_filters,[r]:u}}))},n=r=>u=>{if(r==="filter_by_days")if(u==="0")l("custom_date_range","");else{const w=C();let I=Number.parseInt(u,10);(u==="-1"||u==="1")&&(I=0);const z=w.subtract(I,"day");l("custom_date_range",[z.format("YYYY-MM-DD"),w.format("YYYY-MM-DD")])}if(!A&&r==="post_type"&&u!=="post"){v(!0);return}l(r,u)},y=r=>(u,w)=>{l("filter_by_days","-1"),l(r,w)},f=r=>{l("specific_postIds",r)},k=async()=>{const r=await D(t.post_filters);S((r==null?void 0:r.data)||[])};return L.useEffect(()=>{k()},[t.post_filters]),i(x,{children:[i(b,{layout:"vertical",children:[i(b.Item,{label:s("By the published time of the posts"),required:!0,children:[a(M,{onChange:n("filter_by_days"),options:Qe,placeholder:s("Select publish date"),value:t.post_filters.filter_by_days}),t.post_filters.filter_by_days!=="0"&&t.post_filters.custom_date_range&&a(c,{allowClear:!1,onChange:y("custom_date_range"),style:{marginTop:8},value:[C(t.post_filters.custom_date_range[0],"YYYY-MM-DD"),C(t.post_filters.custom_date_range[1],"YYYY-MM-DD")]})]}),a(b.Item,{label:s("By post type"),children:a(M,{allowClear:!0,loading:h,onChange:n("post_type"),options:j,placeholder:s("Select post type"),value:t.post_filters.post_type})}),a(b.Item,{label:s("By the post category and tag"),children:a(M,{allowClear:!0,filterOption:Ze,loading:_,onChange:n("categories_and_tags"),options:P,placeholder:s("Select category or tag"),showSearch:!0,value:t.post_filters.categories_and_tags})}),a(b.Item,{label:s("Select Specific Post"),children:a(M,{allowClear:!0,filterOption:(r,u)=>u?Ve(r,u):!1,loading:d,mode:"multiple",onChange:f,options:g,placeholder:s("Post ID: Post Title"),showSearch:!0,style:{width:"100%"},value:t.post_filters.specific_postIds})})]}),i(Ue,{css:ce({backgroundColor:e.colorBgElevated,bottom:0,marginBottom:"0 !important",paddingTop:6,position:"sticky"},"",""),level:5,children:[s("Posts matched by current filters"),": ",g==null?void 0:g.length]})]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const{Text:K}=O,{dateFormat:Xe,timeFormat:Je,timeZone:B}=ne(le),et=`${Xe} ${Je}`,tt=be(et),ae=[{label:s("Monday"),value:"Mon"},{label:s("Tuesday"),value:"Tue"},{label:s("Wednesday"),value:"Wed"},{label:s("Thursday"),value:"Thu"},{label:s("Friday"),value:"Fri"},{label:s("Saturday"),value:"Sat"},{label:s("Sunday"),value:"Sun"}];var at={name:"z33n32",styles:"max-width:80px"},st={name:"ypff5m",styles:"min-width:100px"};function ot(){var v,j,P;const[e,t]=F(R),o=Ye(),[c,h]=F(ie),[p,g]=he.useMessage(),S=C(N(B)).format("YYYY-MM-DD HH:mm:ss"),d=(l,n)=>{t(y=>$(y,f=>{f.settings={...f.settings,[l]:n}}))},D=l=>n=>{if(n&&C(n).diff(N(B))<1){h(f=>({...f,startedAt:"Start date & time must be grater than local time"}));return}const y=n==null?void 0:n.format("YYYY-MM-DD HH:mm:ss");if(y)return c.startedAt&&h(f=>({...f,startedAt:""})),d(l,y)},m=l=>n=>{if(l==="sleep_days"&&Array.isArray(n)&&ae.length===n.length){p.open({content:"Minimum one day required for post ",type:"warning"});return}d(l,n)},_=l=>{const{name:n,value:y}=l.target;d(n,y)},A=l=>(n,y)=>{if(n===void 0){t(f=>$(f,k=>{delete k.settings.sleep_time}));return}d(l,y)};return i(b,{layout:"vertical",children:[g,a(b.Item,{label:s("Title"),children:a(te,{name:"name",onChange:_,placeholder:s("Enter a name"),type:"text",value:(v=e.settings)==null?void 0:v.name})}),a(b.Item,{label:s("Start date & time"),children:i(Y,{direction:"vertical",children:[a(Se,{onChangeDate:D,stateData:e,type:"SCHEDULE"}),c.startedAt&&i(K,{type:"danger",children:[c.startedAt," "]}),a(K,{mark:!0,children:Ce(s("Local time: %s ; Time Zone: (%s)"),C(S).format(tt),B)})]})}),a(b.Item,{label:s("Post interval"),style:{margin:"10px 0"},children:i(Y,{children:[a(te,{css:at,min:1,name:"post_interval_value",onChange:_,type:"number",value:e.settings.post_interval_value}),a(M,{css:st,onChange:m("post_interval_type"),options:o,value:e.settings.post_interval_type})]})}),e.id&&e.settings.started_at&&C(e.settings.started_at).diff(N(B))<1&&a(Ee,{message:i(x,{children:[s("If your start time has passed, updating the interval will set your next post to local time plus the new interval! For example, current time 06:00 PM, updated Post interval: 2 hours. Next post will be at 08:00 PM."),a(O.Link,{href:"https://bit-social.com/docs/bit-social/schedule-wordpress-posts-on-social-media/#if-you-update-your-post-interval",rel:"noopener noreferrer",target:"_blank",underline:!0,children:s("Visit our documentation")})]}),showIcon:!0,type:"info"}),a(b.Item,{label:s("Order posts by"),children:a(M,{onChange:m("post_publish_order"),options:[{label:s("Randomly without duplicates"),value:"1"},{label:s("Randomly"),value:"2"},{label:s("Start from the oldest to new posts"),value:"3"},{label:s("Start from the latest to old posts"),value:"4"}],value:e.settings.post_publish_order})}),a(b.Item,{children:i(Y,{direction:"vertical",children:[a(Y,{children:i(K,{children:[" ",s("Set a sleep timer")," "]})}),a(Ae.RangePicker,{format:"HH:mm",onChange:A("sleep_time"),order:!1,value:(j=e.settings.sleep_time)!=null&&j[0]&&((P=e.settings.sleep_time)!=null&&P[1])?[C(e.settings.sleep_time[0],"HH:mm"),C(e.settings.sleep_time[1],"HH:mm")]:void 0})]})}),a(b.Item,{label:s("Set sleep days"),children:a(M,{allowClear:!0,mode:"multiple",onChange:m("sleep_days"),options:ae,placeholder:s("Select sleep days"),value:e.settings.sleep_days})})]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const rt=[{children:a(ot,{}),key:"1",label:"Settings"},{children:a(Ge,{}),key:"2",label:"Post Filter"},{children:a(ze,{}),key:"3",label:"Accounts & Template"}];function nt({handleTabActive:e,tabActive:t,token:o}){return a("div",{style:{paddingInline:24},children:a(qe,{activeKey:t,className:"sticky-tab",css:ce({"& .ant-tabs-nav":{backgroundColor:o.colorBgElevated}},"",""),defaultActiveKey:"1",items:rt,onChange:e})})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};C.extend(we);C.extend(De);const{timeZone:lt}=ne(le);function At({btnTitle:e,isScheduleModalOpen:t,setIsScheduleModalOpen:o}){const{token:c}=oe.useToken(),[h,p]=F(R),g=L.useId(),[S,d]=L.useState("1"),{createSchedule:D,createScheduleLoading:m}=Oe(),{isUpdateScheduleLoading:_,updateSchedule:A}=Re(),[v,j]=he.useMessage(),[P]=_e(),l=Number(P.get("page"))||1,n=Number(P.get("limit"))||10,[y]=F(Pe),{refetchSchedules:f}=Be(y,l,n),k=re(Ie),[r,u]=F(ie),w=(T,E)=>{var q,V,Z,G;return T.settings.name===""?(v.open({content:"name required",type:"error"}),!1):T.settings.started_at===""?(v.open({content:"start time required",type:"error"}),!1):!((q=T.accounts.accountIds)!=null&&q.length)&&!((Z=(V=T.accounts)==null?void 0:V.groupIds)!=null&&Z.length)?(v.open({content:"No account selected",type:"error"}),E("3"),!1):(G=r==null?void 0:r.startedAt)!=null&&G.length?(v.open({content:r.startedAt,type:"error"}),E("1"),!1):!0},I=()=>{d("1");const T=C(N(lt)).format("YYYY-MM-DD HH:mm:ss");p(E=>$(E,q=>{q.settings.started_at=T})),o({open:!0,type:"Create"})},z=async()=>{w(h,d)&&(await(h.id?A(h):D(h)),f(),o({open:!1,type:"Close"}),d("1"),p(X(k)))},Q=()=>{d("1"),o({open:!1,type:"Close"}),u({}),p(X(k))},ue=T=>{d(T)};return i(x,{children:[j,e&&a(W,{icon:a(Ne,{size:12}),onClick:I,size:"large",type:"primary",children:e}),a(ve,{centered:!0,confirmLoading:m||_,footer:i(Y,{children:[a("div",{className:"pr-2",children:a(Me,{type:"message"})}),a(W,{onClick:Q,children:s("Cancel")},"back"),a(W,{loading:m||_,onClick:z,type:"primary",children:h.id?"Update":"Create"},"Ok")]}),maskClosable:!1,onCancel:Q,open:t.open,styles:{body:{marginInline:-24,maxHeight:"calc(100vh - 160px)",overflow:"auto"}},title:`${t==null?void 0:t.type} schedule`,width:S==="3"?800:600,children:a(nt,{handleTabActive:ue,tabActive:S,token:c})},`hello ${g}`)]})}export{At as C,Be as u};
