import{r as re,c as ie,h as ne,g as ce,e as le,_ as o,j as s,a as l,L as x,l as D,n as de,F as v,m as T,p as he}from"./main-plenty-doors-read.js";import{u as ue,t as ge,$ as pe,a as me}from"./DatePicker-C_Ae06qk.js";import{u as Se}from"./useDebounce-DWVHBZjD.js";import{C as fe}from"./CronWarning-CwRxBjLQ.js";import{u as xe,N as Te}from"./useUpdateScheduleStatus-DCzOCLul.js";import{u as ye,C as $}from"./CreateScheduleModal-wOiaNpqx.js";import{D as be,R as _e}from"./Refresh-BuaHVLqa.js";import{r as I,s as Ce,T as P,q as F,v as Ae,B as y,P as L,S as k,z as w,F as ve,I as Ie,E as Pe,n as ke,x as Ee}from"./antd-Dkhz2BjJ.js";import{u as we}from"./router-BDBqwsZt.js";import{a as Me,b as Ne}from"./react-query-B4O-PG_a.js";import"./css-in-js-D9KZUreV.js";import"./useSocialTemplates-DyNqVUWx.js";import"./PlatformIcon-nT1RWFgS.js";import"./useIntervalTypes--1bNiVZ0.js";import"./groupHelper-DRF28X9S.js";import"./index-0DjDwEVr.js";import"./usePostTypes-KCSyQMKq.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,i){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,i),i)}};function je(){const t=Me(),{isPending:i,isSuccess:g,mutateAsync:S}=Ne({mutationFn:async d=>{if(!d.length)throw new Error("Schedule ID is undefined");return re("schedule/destroy",{scheduleIds:d},void 0,"POST")},onSuccess:()=>{t.invalidateQueries({queryKey:["get-calendar-schedules"]}),t.invalidateQueries({queryKey:["all-schedules"]})}});return{deleteSchedule:d=>S(d),deleteScheduleLoading:i,deleteScheduleSuccess:g}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,i){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,i),i)}};w.extend(ue);w.extend(ge);const De=({token:t})=>({background:t.colorSuccessBg,border:`1px solid ${t.colorSuccessBorder}`,borderRadius:"10px",color:t.colorSuccessText,minWidth:"90px"}),$e=({token:t})=>({background:t.colorWarningBg,border:`1px solid ${t.colorWarningBorder}`,borderRadius:"10px",color:t.colorWarningText,minWidth:"90px"}),u=1,E=0,z=2;function Xe(){const[t,i]=we(),g=Number(t.get("page"))||1,S=Number(t.get("limit"))||10,[d,b]=I.useState({open:!1,type:"Create"}),[_,p]=I.useState([]),R=ie(pe),[M,B]=ne(me),h=Se(M,300),{isFetchingSchedules:N,isLoadingSchedules:C,refetchSchedules:f,scheduleData:n,totalPages:A,totalSchedule:O}=ye(h,g,S),{deleteSchedule:j,deleteScheduleLoading:W}=je(),{updateScheduleStatus:q}=xe(),[U,H]=Ce.useNotification(),{timeZone:Q}=ce(le),Y=(e,r="success")=>{U[r]({description:e,message:"Share Now"})},K=(e,r)=>{i(a=>(a.set("page",String(e)),a.set("limit",String(r)),a))},V=e=>{const r=n.find(a=>a.id===e);r&&(R(he(r.config,a=>{a.id=r.id})),b({open:!0,type:"Edit"}))},Z=e=>{B(e.target.value)},G=async()=>{await j(_),p([]),f()},J=async e=>{await j([e]),f()},X=async(e,r)=>{const{data:a,status:c}=await q({id:e,status:r});Y(a,c),f()},ee=[{dataIndex:"title",key:"title",title:o("Title"),width:"20%"},{dataIndex:"created_at",key:"created_at",title:o("Created At")},{dataIndex:"start",key:"start",title:o("Start Scheduled Post")},{dataIndex:"interval",key:"interval",render:(e,{interval:r})=>{var a;return(a=r.settings)!=null&&a.post_interval_value?s(P.Text,{children:`${r.settings.post_interval_value}  ${r.settings.post_interval_type}`}):"-"},title:o("Interval ")},{dataIndex:"nextPost",key:"nextPost",title:o("Next Post ")},{dataIndex:"status",key:"status",render:(e,{interval:r,key:a,status:c})=>{var m;if(!((m=r.settings)!=null&&m.post_interval_value)&&c===u)return s(F,{color:"green",children:o("In Progress")});switch(c){case z:return s(F,{color:"grey",children:o("Completed")});case u:case E:return s(Ae,{css:c===u?De:$e,onChange:oe=>X(a,Number(oe)),options:[{disabled:c===u,label:o("Active"),value:u},{disabled:c===E,label:o("Paused"),value:E}],size:"small",value:c===u?"Active":"Paused",variant:"borderless"})}},title:o("Status")},{dataIndex:"action",key:"action",render:(e,{interval:r,key:a,status:c})=>{var m;return l(k,{direction:"horizontal",children:[((m=r.settings)==null?void 0:m.post_interval_value)&&c!==z&&s(y,{icon:s(x,{name:"pencil"}),onClick:()=>V(a),type:"text"}),s(L,{description:o("Are you sure you want to delete this schedule?"),okButtonProps:{danger:!0,loading:W},okText:o("Yes, Delete"),onConfirm:()=>J(a),placement:"right",title:o("Delete?"),children:s(y,{danger:!0,icon:s(x,{name:"trash-2"}),type:"text"})})]})},title:o("Action ")}],te=n&&n.map(e=>({created_at:D(e.created_at,`${T.DATE_FORMAT} ${T.TIME_FORMAT}`),interval:e.config,key:e.id,nextPost:e.next_published_at&&e.status===1&&w(e.next_published_at).diff(de(Q))>1?e.human_readable_next_publish:"-",start:e!=null&&e.started_at?D(e.started_at,`${T.DATE_FORMAT} ${T.TIME_FORMAT}`):"-",status:e.status,title:e.name})),ae={onSelect:(e,r)=>{if(e){if(r){p(a=>[...a,e.key]);return}p(a=>a.filter(c=>c!==e.key))}},onSelectAll:(e,r)=>{if(e){p(r.map(a=>a==null?void 0:a.key).filter(a=>a!==void 0));return}p([])}},se=_.length>0;return I.useEffect(()=>{!n.length&&A&&g>A&&i(e=>(e.set("page",String(A)),e))},[n]),l(v,{children:[H,l(ve,{className:"mb-1",justify:"space-between",children:[l(k,{children:[!h&&n.length||h?s(Ie,{onChange:Z,placeholder:o("Search schedule"),prefix:s(x,{name:"search"}),value:M}):void 0,se?l(v,{children:[s(P.Text,{children:`Selected ${_.length} items`}),s(L,{description:o("Are you sure to delete this logs?"),okButtonProps:{danger:!0},okText:o("Yes, Delete"),onConfirm:G,placement:"right",title:o("Delete Logs"),children:s(y,{className:"ml-2",danger:!0,icon:s(be,{}),type:"text"})})]}):void 0]}),s("div",{children:!h&&n.length||h?l(k,{children:[l(P.Link,{href:"https://bit-social.com/docs/schedule-wordpress-posts-on-social-media/",rel:"noopener noreferrer",strong:!0,style:{fontSize:"18px"},target:"_blank",children:[o("How to create schedule"),s(x,{name:"move-up-right",style:{transform:"translateY(-2px)"}})]}),s(y,{disabled:N,icon:s(_e,{spin:N}),onClick:()=>f(),size:"large",children:o("Refresh")}),s($,{btnTitle:o("Create Schedule"),isScheduleModalOpen:d,setIsScheduleModalOpen:b})]}):void 0})]}),C&&s(ke,{}),n!=null&&n.length?l(v,{children:[s(fe,{}),s(Ee,{bordered:!0,className:"mt-1",columns:ee,dataSource:te,pagination:{current:g,defaultCurrent:1,onChange:K,pageSize:S,showSizeChanger:!0,total:O},rowSelection:ae})]}):void 0,!C&&!(n!=null&&n.length)?s(Pe,{description:o("No schedule found!"),children:!h&&s($,{btnTitle:o("Create Schedule"),isScheduleModalOpen:d,setIsScheduleModalOpen:b})}):void 0,!C&&!(n!=null&&n.length)?s(Te,{fontSize:"1.6rem",section:"schedule",style:{marginTop:"30px",textAlign:"justify"}}):void 0]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,i){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,i),i)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,i){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,i),i)}};export{Xe as default};
