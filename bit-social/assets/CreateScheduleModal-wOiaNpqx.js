import{r as H,j as a,a as c,A as de,h as j,F as Y,_ as s,p as L,u as se,b as pe,c as ge,d as me,L as ye,g as oe,e as re,o as fe,n as N,q as be}from"./main-plenty-doors-read.js";import{$ as O,T as Ce,b as ne,D as _e,u as ve,t as Te,d as J,a as Se}from"./DatePicker-C_Ae06qk.js";import{$ as Ae}from"./useSocialTemplates-DyNqVUWx.js";import{C as we}from"./CronWarning-CwRxBjLQ.js";import{u as le,a as De,b as U}from"./react-query-B4O-PG_a.js";import{r as $,F as Pe,T as z,j as X,k as Ie,t as ce,o as b,v as M,z as C,u as Me,w as ie,I as ee,S as x,m as je,G as Fe,H as ke,B as K,M as Ye}from"./antd-Dkhz2BjJ.js";import{u as xe}from"./router-BDBqwsZt.js";import{a as he}from"./css-in-js-D9KZUreV.js";import{u as Le,C as te}from"./groupHelper-DRF28X9S.js";import{F as $e,A as He,u as Ee}from"./useIntervalTypes--1bNiVZ0.js";import{u as qe}from"./usePostTypes-KCSyQMKq.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Be(e,t,o){const{data:i,isFetching:h,isLoading:p,refetch:g}=le({queryFn:async()=>H(`schedule/${e}${e?"/":""}${t}/${o}`,void 0,void 0,"GET"),queryKey:[`get-schedules-${e}`,[t,o]],refetchInterval:5e3}),{current_page:S,current_total:d,data:D,pages:m,per_page:_,total:A}=(i==null?void 0:i.data)||{};return{currentPage:S,currentTotal:d,isFetchingSchedules:h,isLoadingSchedules:p,perPage:_,refetchSchedules:g,scheduleData:D||[],totalPages:m,totalSchedule:A}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Ne({className:e,size:t="1em",stroke:o=2}){return a(de,{children:c("svg",{className:`svgIcn ${e}`,fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:o,viewBox:"0 0 24 24",width:t,children:[a("line",{x1:"12",x2:"12",y1:"5",y2:"19"}),a("line",{x1:"5",x2:"19",y1:"12",y2:"12"})]})})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Oe(){const e=De(),{isPending:t,mutateAsync:o}=U({mutationFn:async i=>H("schedule",{...i},void 0,"POST"),onSuccess:()=>{e.invalidateQueries({queryKey:["all-schedules"]}),e.invalidateQueries({queryKey:["get-calendar-schedules"]})}});return{createSchedule:i=>o(i),createScheduleLoading:t}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function ze(){const{isPending:e,mutateAsync:t}=U({mutationFn:async o=>{if(!o.id)throw new Error("Schedule ID is undefined");return H(`schedule/${o.id}/update`,{...o},void 0,"POST")}});return{isUpdateScheduleLoading:e,updateSchedule:o=>t(o)}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Re(){const[e,t]=j(O),{accounts:o}=Le(),i=h=>{t(p=>L(p,g=>{g.accounts={accountIds:h.accountIds,groupIds:h==null?void 0:h.groupIds}}))};return $.useEffect(()=>{i(e.accounts)},[]),o.length?c(Ie,{gutter:20,children:[a(X,{span:10,children:c(Y,{children:[c(Pe,{className:"mb-1",justify:"space-between",children:[a(z.Title,{level:5,children:s("Accounts")}),a(te,{})]}),a($e,{selectedAccount:e.accounts,setSelectedAccount:i})]})}),a(X,{span:14,children:a(Ce,{})})]}):c(Y,{children:[a(He,{iconSize:40,textLevel:4}),a("div",{style:{textAlign:"center"},children:a(te,{})})]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Ke(e){const{data:t,isLoading:o}=le({queryFn:async()=>H("categories",void 0,{postType:e},"GET"),queryKey:["categories",e]});return{categoriesAndTags:t==null?void 0:t.data,isLoadingCategories:o}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function We(){const{isPending:e,mutateAsync:t}=U({mutationFn:async o=>H("filtered-posts",{...o},void 0,"POST")});return{loadingPostFilter:e,postFilter:o=>t(o)}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const{Title:Ue}=z,Qe=[{label:s("All times"),value:"0"},{label:s("Today"),value:"1"},{label:s("last 7 days"),value:"7"},{label:s("last 15 days"),value:"15"},{label:s("last 30 days"),value:"30"},{label:s("last 90 days"),value:"90"},{label:s("last 180 days"),value:"180"},{label:s("last 365 days"),value:"365"},{label:s("custom date range"),value:"-1"}];function Ve(e,t){return t.label.toLowerCase().includes(e.toLowerCase())}const Ze=(e,t)=>((t==null?void 0:t.label)??"").toLowerCase().includes(e.toLowerCase());function Ge(){const{token:e}=ce.useToken(),[t,o]=j(O),{RangePicker:i}=Me,{loadingPostType:h,postTypes:p}=qe(),[g,S]=$.useState([]),{loadingPostFilter:d,postFilter:D}=We(),{categoriesAndTags:m,isLoadingCategories:_}=Ke(t.post_filters.post_type||""),{isProClient:A}=se(pe),v=ge(me),F=p&&Object.values(p).map(r=>({label:c(Y,{children:[r.label," ",r.name!=="post"&&!A&&a(ye,{color:"#ff8609",name:"crown",size:16})]}),value:r.name})),P=m?Object.keys(m).map(r=>({label:r,options:m[r].map(u=>({label:u.name,value:u.id}))})):[],l=(r,u)=>{o(w=>L(w,I=>{I.post_filters={...I.post_filters,[r]:u}}))},n=r=>u=>{if(r==="filter_by_days")if(u==="0")l("custom_date_range","");else{const w=C();let I=Number.parseInt(u,10);(u==="-1"||u==="1")&&(I=0);const R=w.subtract(I,"day");l("custom_date_range",[R.format("YYYY-MM-DD"),w.format("YYYY-MM-DD")])}if(!A&&r==="post_type"&&u!=="post"){v(!0);return}l(r,u)},y=r=>(u,w)=>{l("filter_by_days","-1"),l(r,w)},f=r=>{l("specific_postIds",r)},k=async()=>{const r=await D(t.post_filters);S((r==null?void 0:r.data)||[])};return $.useEffect(()=>{k()},[t.post_filters]),c(Y,{children:[c(b,{layout:"vertical",children:[c(b.Item,{label:s("By the published time of the posts"),required:!0,children:[a(M,{onChange:n("filter_by_days"),options:Qe,placeholder:s("Select publish date"),value:t.post_filters.filter_by_days}),t.post_filters.filter_by_days!=="0"&&t.post_filters.custom_date_range&&a(i,{allowClear:!1,onChange:y("custom_date_range"),style:{marginTop:8},value:[C(t.post_filters.custom_date_range[0],"YYYY-MM-DD"),C(t.post_filters.custom_date_range[1],"YYYY-MM-DD")]})]}),a(b.Item,{label:s("By post type"),children:a(M,{allowClear:!0,loading:h,onChange:n("post_type"),options:F,placeholder:s("Select post type"),value:t.post_filters.post_type})}),a(b.Item,{label:s("By the post category and tag"),children:a(M,{allowClear:!0,filterOption:Ze,loading:_,onChange:n("categories_and_tags"),options:P,placeholder:s("Select category or tag"),showSearch:!0,value:t.post_filters.categories_and_tags})}),a(b.Item,{label:s("Select Specific Post"),children:a(M,{allowClear:!0,filterOption:(r,u)=>u?Ve(r,u):!1,loading:d,mode:"multiple",onChange:f,options:g,placeholder:s("Post ID: Post Title"),showSearch:!0,style:{width:"100%"},value:t.post_filters.specific_postIds})})]}),c(Ue,{css:he({backgroundColor:e.colorBgElevated,bottom:0,marginBottom:"0 !important",paddingTop:6,position:"sticky"},"",""),level:5,children:[s("Posts matched by current filters"),": ",g==null?void 0:g.length]})]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const{Text:W}=z,{dateFormat:Je,timeFormat:Xe,timeZone:B}=oe(re),et=`${Je} ${Xe}`,tt=fe(et),ae=[{label:s("Monday"),value:"Mon"},{label:s("Tuesday"),value:"Tue"},{label:s("Wednesday"),value:"Wed"},{label:s("Thursday"),value:"Thu"},{label:s("Friday"),value:"Fri"},{label:s("Saturday"),value:"Sat"},{label:s("Sunday"),value:"Sun"}];var at={name:"z33n32",styles:"max-width:80px"},st={name:"ypff5m",styles:"min-width:100px"};function ot(){var v,F,P;const[e,t]=j(O),o=Ee(),[i,h]=j(ne),[p,g]=ie.useMessage(),S=C(N(B)).format("YYYY-MM-DD HH:mm:ss"),d=(l,n)=>{t(y=>L(y,f=>{f.settings={...f.settings,[l]:n}}))},D=l=>n=>{if(n&&C(n).diff(N(B))<1){h(f=>({...f,startedAt:"Start date & time must be grater than local time"}));return}const y=n==null?void 0:n.format("YYYY-MM-DD HH:mm:ss");if(y)return i.startedAt&&h(f=>({...f,startedAt:""})),d(l,y)},m=l=>n=>{if(l==="sleep_days"&&Array.isArray(n)&&ae.length===n.length){p.open({content:"Minimum one day required for post ",type:"warning"});return}d(l,n)},_=l=>{const{name:n,value:y}=l.target;d(n,y)},A=l=>(n,y)=>{if(n===void 0){t(f=>L(f,k=>{delete k.settings.sleep_time}));return}d(l,y)};return c(b,{layout:"vertical",children:[g,a(b.Item,{label:s("Title"),children:a(ee,{name:"name",onChange:_,placeholder:s("Enter a name"),type:"text",value:(v=e.settings)==null?void 0:v.name})}),a(b.Item,{label:s("Start date & time"),children:c(x,{direction:"vertical",children:[a(_e,{onChangeDate:D,stateData:e,type:"SCHEDULE"}),i.startedAt&&c(W,{type:"danger",children:[i.startedAt," "]}),a(W,{mark:!0,children:be(s("Local time: %s ; Time Zone: (%s)"),C(S).format(tt),B)})]})}),a(b.Item,{label:s("Post interval"),style:{margin:"10px 0"},children:c(x,{children:[a(ee,{css:at,min:1,name:"post_interval_value",onChange:_,type:"number",value:e.settings.post_interval_value}),a(M,{css:st,onChange:m("post_interval_type"),options:o,value:e.settings.post_interval_type})]})}),e.id&&e.settings.started_at&&C(e.settings.started_at).diff(N(B))<1&&a(je,{message:c(Y,{children:[s("If your start time has passed, updating the interval will set your next post to local time plus the new interval! For example, current time 06:00 PM, updated Post interval: 2 hours. Next post will be at 08:00 PM."),a(z.Link,{href:"https://bit-social.com/docs/bit-social/schedule-wordpress-posts-on-social-media/#if-you-update-your-post-interval",rel:"noopener noreferrer",target:"_blank",underline:!0,children:s("Visit our documentation")})]}),showIcon:!0,type:"info"}),a(b.Item,{label:s("Order posts by"),children:a(M,{onChange:m("post_publish_order"),options:[{label:s("Randomly without duplicates"),value:"1"},{label:s("Randomly"),value:"2"},{label:s("Start from the oldest to new posts"),value:"3"},{label:s("Start from the latest to old posts"),value:"4"}],value:e.settings.post_publish_order})}),a(b.Item,{children:c(x,{direction:"vertical",children:[a(x,{children:c(W,{children:[" ",s("Set a sleep timer")," "]})}),a(Fe.RangePicker,{format:"HH:mm",onChange:A("sleep_time"),order:!1,value:(F=e.settings.sleep_time)!=null&&F[0]&&((P=e.settings.sleep_time)!=null&&P[1])?[C(e.settings.sleep_time[0],"HH:mm"),C(e.settings.sleep_time[1],"HH:mm")]:void 0})]})}),a(b.Item,{label:s("Set sleep days"),children:a(M,{allowClear:!0,mode:"multiple",onChange:m("sleep_days"),options:ae,placeholder:s("Select sleep days"),value:e.settings.sleep_days})})]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const rt=[{children:a(ot,{}),key:"1",label:"Settings"},{children:a(Ge,{}),key:"2",label:"Post Filter"},{children:a(Re,{}),key:"3",label:"Accounts & Template"}];function nt({handleTabActive:e,tabActive:t,token:o}){return a("div",{style:{paddingInline:24},children:a(ke,{activeKey:t,className:"sticky-tab",css:he({"& .ant-tabs-nav":{backgroundColor:o.colorBgElevated}},"",""),defaultActiveKey:"1",items:rt,onChange:e})})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};C.extend(ve);C.extend(Te);const{timeZone:lt}=oe(re);function Ct({btnTitle:e,isScheduleModalOpen:t,setIsScheduleModalOpen:o}){const{token:i}=ce.useToken(),[h,p]=j(O),g=$.useId(),[S,d]=$.useState("1"),{createSchedule:D,createScheduleLoading:m}=Oe(),{isUpdateScheduleLoading:_,updateSchedule:A}=ze(),[v,F]=ie.useMessage(),[P]=xe(),l=Number(P.get("page"))||1,n=Number(P.get("limit"))||10,[y]=j(Se),{refetchSchedules:f}=Be(y,l,n),k=se(Ae),[r,u]=j(ne),w=(T,E)=>{var q,V,Z,G;return T.settings.name===""?(v.open({content:"name required",type:"error"}),!1):T.settings.started_at===""?(v.open({content:"start time required",type:"error"}),!1):!((q=T.accounts.accountIds)!=null&&q.length)&&!((Z=(V=T.accounts)==null?void 0:V.groupIds)!=null&&Z.length)?(v.open({content:"No account selected",type:"error"}),E("3"),!1):(G=r==null?void 0:r.startedAt)!=null&&G.length?(v.open({content:r.startedAt,type:"error"}),E("1"),!1):!0},I=()=>{d("1");const T=C(N(lt)).format("YYYY-MM-DD HH:mm:ss");p(E=>L(E,q=>{q.settings.started_at=T})),o({open:!0,type:"Create"})},R=async()=>{w(h,d)&&(await(h.id?A(h):D(h)),f(),o({open:!1,type:"Close"}),d("1"),p(J(k)))},Q=()=>{d("1"),o({open:!1,type:"Close"}),u({}),p(J(k))},ue=T=>{d(T)};return c(Y,{children:[F,e&&a(K,{icon:a(Ne,{size:12}),onClick:I,size:"large",type:"primary",children:e}),a(Ye,{centered:!0,confirmLoading:m||_,footer:c(x,{children:[a("div",{className:"pr-2",children:a(we,{type:"message"})}),a(K,{onClick:Q,children:s("Cancel")},"back"),a(K,{loading:m||_,onClick:R,type:"primary",children:h.id?"Update":"Create"},"Ok")]}),maskClosable:!1,onCancel:Q,open:t.open,styles:{body:{marginInline:-24,maxHeight:"calc(100vh - 160px)",overflow:"auto"}},title:`${t==null?void 0:t.type} schedule`,width:S==="3"?800:600,children:a(nt,{handleTabActive:ue,tabActive:S,token:i})},`hello ${g}`)]})}export{Ct as C,Be as u};
