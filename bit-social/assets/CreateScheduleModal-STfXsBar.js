import{ag as se,z as E,j as a,B as i,x as ue,y as Q,a4 as F,r as L,F as x,T as N,D as s,a5 as $,A as oe,H as re,K as pe,I as ge,M as me,J as fe,as as B,a2 as ne,S as Y,au as ye,av as be,a3 as le,G as Ce,E as K,Q as _e}from"./main-loud-buses-flash.js";import{a as R,T as ve,c as ie,D as Te,d as Se,b as Ae,e as J,u as we,t as De}from"./DatePicker-DCqK1UVl.js";import{$ as Pe}from"./useSocialTemplates-BwgKo5Jp.js";import{C as Me}from"./CronWarning-C0g1dMTy.js";import{A as Ie}from"./AntIconWrapper-DHRAa4bg.js";import{D as Fe,d as C}from"./index-CKdsFPZp.js";import{c as ce}from"./emotion-react.browser.esm-Bkh3-jte.js";import{u as je,C as X}from"./groupHelper-B64LUuva.js";import{F as ke,A as xe,u as Ye}from"./useIntervalTypes-BdE4rls8.js";import{C as ee,R as Le}from"./row-DRTpapjx.js";import{F as $e}from"./index-DgGTU6wh.js";import{u as Ee}from"./usePostTypes-BAPXlsIQ.js";import{F as b}from"./index-CFBVgFmB.js";import{S as I}from"./Input-7tgEkJGt.js";import{s as he}from"./index-CKeXLLi4.js";import{I as te}from"./index-CqCAQhpV.js";import{A as He}from"./index-Cu09ibcz.js";import{T as qe}from"./index-Bgwsj8B4.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Oe(e,t,o){const{data:c,isFetching:h,isLoading:p,refetch:g}=se({queryFn:async()=>E(`schedule/${e}${e?"/":""}${t}/${o}`,void 0,void 0,"GET"),queryKey:[`get-schedules-${e}`,[t,o]],refetchInterval:5e3}),{current_page:S,current_total:u,data:D,pages:m,per_page:_,total:A}=(c==null?void 0:c.data)||{};return{currentPage:S,currentTotal:u,isFetchingSchedules:h,isLoadingSchedules:p,perPage:_,refetchSchedules:g,scheduleData:D||[],totalPages:m,totalSchedule:A}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Be({className:e,size:t="1em",stroke:o=2}){return a(Ie,{children:i("svg",{className:`svgIcn ${e}`,fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:o,viewBox:"0 0 24 24",width:t,children:[a("line",{x1:"12",x2:"12",y1:"5",y2:"19"}),a("line",{x1:"5",x2:"19",y1:"12",y2:"12"})]})})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Ne(){const e=ue(),{isPending:t,mutateAsync:o}=Q({mutationFn:async c=>E("schedule",{...c},void 0,"POST"),onSuccess:()=>{e.invalidateQueries({queryKey:["all-schedules"]}),e.invalidateQueries({queryKey:["get-calendar-schedules"]})}});return{createSchedule:c=>o(c),createScheduleLoading:t}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Re(){const{isPending:e,mutateAsync:t}=Q({mutationFn:async o=>{if(!o.id)throw new Error("Schedule ID is undefined");return E(`schedule/${o.id}/update`,{...o},void 0,"POST")}});return{isUpdateScheduleLoading:e,updateSchedule:o=>t(o)}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function ze(){const[e,t]=F(R),{accounts:o}=je(),c=h=>{t(p=>$(p,g=>{g.accounts={accountIds:h.accountIds,groupIds:h==null?void 0:h.groupIds}}))};return L.useEffect(()=>{c(e.accounts)},[]),o.length?i(Le,{gutter:20,children:[a(ee,{span:10,children:i(x,{children:[i($e,{className:"mb-1",justify:"space-between",children:[a(N.Title,{level:5,children:s("Accounts")}),a(X,{})]}),a(ke,{selectedAccount:e.accounts,setSelectedAccount:c})]})}),a(ee,{span:14,children:a(ve,{})})]}):i(x,{children:[a(xe,{iconSize:40,textLevel:4}),a("div",{style:{textAlign:"center"},children:a(X,{})})]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Ke(e){const{data:t,isLoading:o}=se({queryFn:async()=>E("categories",void 0,{postType:e},"GET"),queryKey:["categories",e]});return{categoriesAndTags:t==null?void 0:t.data,isLoadingCategories:o}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function We(){const{isPending:e,mutateAsync:t}=Q({mutationFn:async o=>E("filtered-posts",{...o},void 0,"POST")});return{loadingPostFilter:e,postFilter:o=>t(o)}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const{Title:Qe}=N,Ue=[{label:s("All times"),value:"0"},{label:s("Today"),value:"1"},{label:s("last 7 days"),value:"7"},{label:s("last 15 days"),value:"15"},{label:s("last 30 days"),value:"30"},{label:s("last 90 days"),value:"90"},{label:s("last 180 days"),value:"180"},{label:s("last 365 days"),value:"365"},{label:s("custom date range"),value:"-1"}];function Ve(e,t){return t.label.toLowerCase().includes(e.toLowerCase())}const Ze=(e,t)=>((t==null?void 0:t.label)??"").toLowerCase().includes(e.toLowerCase());function Ge(){const{token:e}=oe.useToken(),[t,o]=F(R),{RangePicker:c}=Fe,{loadingPostType:h,postTypes:p}=Ee(),[g,S]=L.useState([]),{loadingPostFilter:u,postFilter:D}=We(),{categoriesAndTags:m,isLoadingCategories:_}=Ke(t.post_filters.post_type||""),{isProClient:A}=re(pe),v=ge(me),j=p&&Object.values(p).map(r=>({label:i(x,{children:[r.label," ",r.name!=="post"&&!A&&a(fe,{color:"#ff8609",size:16})]}),value:r.name})),P=m?Object.keys(m).map(r=>({label:r,options:m[r].map(d=>({label:d.name,value:d.id}))})):[],l=(r,d)=>{o(w=>$(w,M=>{M.post_filters={...M.post_filters,[r]:d}}))},n=r=>d=>{if(r==="filter_by_days")if(d==="0")l("custom_date_range","");else{const w=C();let M=Number.parseInt(d,10);(d==="-1"||d==="1")&&(M=0);const z=w.subtract(M,"day");l("custom_date_range",[z.format("YYYY-MM-DD"),w.format("YYYY-MM-DD")])}if(!A&&r==="post_type"&&d!=="post"){v(!0);return}l(r,d)},f=r=>(d,w)=>{l("filter_by_days","-1"),l(r,w)},y=r=>{l("specific_postIds",r)},k=async()=>{const r=await D(t.post_filters);S((r==null?void 0:r.data)||[])};return L.useEffect(()=>{k()},[t.post_filters]),i(x,{children:[i(b,{layout:"vertical",children:[i(b.Item,{label:s("By the published time of the posts"),required:!0,children:[a(I,{onChange:n("filter_by_days"),options:Ue,placeholder:s("Select publish date"),value:t.post_filters.filter_by_days}),t.post_filters.filter_by_days!=="0"&&t.post_filters.custom_date_range&&a(c,{allowClear:!1,onChange:f("custom_date_range"),style:{marginTop:8},value:[C(t.post_filters.custom_date_range[0],"YYYY-MM-DD"),C(t.post_filters.custom_date_range[1],"YYYY-MM-DD")]})]}),a(b.Item,{label:s("By post type"),children:a(I,{allowClear:!0,loading:h,onChange:n("post_type"),options:j,placeholder:s("Select post type"),value:t.post_filters.post_type})}),a(b.Item,{label:s("By the post category and tag"),children:a(I,{allowClear:!0,filterOption:Ze,loading:_,onChange:n("categories_and_tags"),options:P,placeholder:s("Select category or tag"),showSearch:!0,value:t.post_filters.categories_and_tags})}),a(b.Item,{label:s("Select Specific Post"),children:a(I,{allowClear:!0,filterOption:(r,d)=>d?Ve(r,d):!1,loading:u,mode:"multiple",onChange:y,options:g,placeholder:s("Post ID: Post Title"),showSearch:!0,style:{width:"100%"},value:t.post_filters.specific_postIds})})]}),i(Qe,{css:ce({backgroundColor:e.colorBgElevated,bottom:0,marginBottom:"0 !important",paddingTop:6,position:"sticky"},"",""),level:5,children:[s("Posts matched by current filters"),": ",g==null?void 0:g.length]})]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const{Text:W}=N,{dateFormat:Je,timeFormat:Xe,timeZone:O}=ne(le),et=`${Je} ${Xe}`,tt=be(et),ae=[{label:s("Monday"),value:"Mon"},{label:s("Tuesday"),value:"Tue"},{label:s("Wednesday"),value:"Wed"},{label:s("Thursday"),value:"Thu"},{label:s("Friday"),value:"Fri"},{label:s("Saturday"),value:"Sat"},{label:s("Sunday"),value:"Sun"}];var at={name:"z33n32",styles:"max-width:80px"},st={name:"ypff5m",styles:"min-width:100px"};function ot(){var v,j,P;const[e,t]=F(R),o=Ye(),[c,h]=F(ie),[p,g]=he.useMessage(),S=C(B(O)).format("YYYY-MM-DD HH:mm:ss"),u=(l,n)=>{t(f=>$(f,y=>{y.settings={...y.settings,[l]:n}}))},D=l=>n=>{if(n&&C(n).diff(B(O))<1){h(y=>({...y,startedAt:"Start date & time must be grater than local time"}));return}const f=n==null?void 0:n.format("YYYY-MM-DD HH:mm:ss");if(f)return c.startedAt&&h(y=>({...y,startedAt:""})),u(l,f)},m=l=>n=>{if(l==="sleep_days"&&Array.isArray(n)&&ae.length===n.length){p.open({content:"Minimum one day required for post ",type:"warning"});return}u(l,n)},_=l=>{const{name:n,value:f}=l.target;u(n,f)},A=l=>(n,f)=>{if(n===void 0){t(y=>$(y,k=>{delete k.settings.sleep_time}));return}u(l,f)};return i(b,{layout:"vertical",children:[g,a(b.Item,{label:s("Title"),children:a(te,{name:"name",onChange:_,placeholder:s("Enter a name"),type:"text",value:(v=e.settings)==null?void 0:v.name})}),a(b.Item,{label:s("Start date & time"),children:i(Y,{direction:"vertical",children:[a(Te,{onChangeDate:D,stateData:e,type:"SCHEDULE"}),c.startedAt&&i(W,{type:"danger",children:[c.startedAt," "]}),a(W,{mark:!0,children:ye(s("Local time: %s ; Time Zone: (%s)"),C(S).format(tt),O)})]})}),a(b.Item,{label:s("Post interval"),style:{margin:"10px 0"},children:i(Y,{children:[a(te,{css:at,min:1,name:"post_interval_value",onChange:_,type:"number",value:e.settings.post_interval_value}),a(I,{css:st,onChange:m("post_interval_type"),options:o,value:e.settings.post_interval_type})]})}),e.id&&e.settings.started_at&&C(e.settings.started_at).diff(B(O))<1&&a(He,{message:i(x,{children:[s("If your start time has passed, updating the interval will set your next post to local time plus the new interval! For example, current time 06:00 PM, updated Post interval: 2 hours. Next post will be at 08:00 PM."),a(N.Link,{href:"https://bit-social.com/docs/bit-social/schedule-wordpress-posts-on-social-media/#if-you-update-your-post-interval",rel:"noopener noreferrer",target:"_blank",underline:!0,children:s("Visit our documentation")})]}),showIcon:!0,type:"info"}),a(b.Item,{label:s("Order posts by"),children:a(I,{onChange:m("post_publish_order"),options:[{label:s("Randomly without duplicates"),value:"1"},{label:s("Randomly"),value:"2"},{label:s("Start from the oldest to new posts"),value:"3"},{label:s("Start from the latest to old posts"),value:"4"}],value:e.settings.post_publish_order})}),a(b.Item,{children:i(Y,{direction:"vertical",children:[a(Y,{children:i(W,{children:[" ",s("Set a sleep timer")," "]})}),a(Se.RangePicker,{format:"HH:mm",onChange:A("sleep_time"),order:!1,value:(j=e.settings.sleep_time)!=null&&j[0]&&((P=e.settings.sleep_time)!=null&&P[1])?[C(e.settings.sleep_time[0],"HH:mm"),C(e.settings.sleep_time[1],"HH:mm")]:void 0})]})}),a(b.Item,{label:s("Set sleep days"),children:a(I,{allowClear:!0,mode:"multiple",onChange:m("sleep_days"),options:ae,placeholder:s("Select sleep days"),value:e.settings.sleep_days})})]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const rt=[{children:a(ot,{}),key:"1",label:"Settings"},{children:a(Ge,{}),key:"2",label:"Post Filter"},{children:a(ze,{}),key:"3",label:"Accounts & Template"}];function nt({handleTabActive:e,tabActive:t,token:o}){return a("div",{style:{paddingInline:24},children:a(qe,{activeKey:t,className:"sticky-tab",css:ce({"& .ant-tabs-nav":{backgroundColor:o.colorBgElevated}},"",""),defaultActiveKey:"1",items:rt,onChange:e})})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};C.extend(we);C.extend(De);const{timeZone:lt}=ne(le),it={create:"Create schedule",edit:"Edit schedule",reSchedule:"Reschedule"};function Pt({btnTitle:e,isScheduleModalOpen:t,setIsScheduleModalOpen:o}){const{token:c}=oe.useToken(),[h,p]=F(R),g=L.useId(),[S,u]=L.useState("1"),{createSchedule:D,createScheduleLoading:m}=Ne(),{isUpdateScheduleLoading:_,updateSchedule:A}=Re(),[v,j]=he.useMessage(),[P]=Ce(),l=Number(P.get("page"))||1,n=Number(P.get("limit"))||10,[f]=F(Ae),{refetchSchedules:y}=Oe(f,l,n),k=re(Pe),[r,d]=F(ie),w=(T,H)=>{var q,V,Z,G;return T.settings.name===""?(v.open({content:"name required",type:"error"}),!1):T.settings.started_at===""?(v.open({content:"start time required",type:"error"}),!1):!((q=T.accounts.accountIds)!=null&&q.length)&&!((Z=(V=T.accounts)==null?void 0:V.groupIds)!=null&&Z.length)?(v.open({content:"No account selected",type:"error"}),H("3"),!1):(G=r==null?void 0:r.startedAt)!=null&&G.length?(v.open({content:r.startedAt,type:"error"}),H("1"),!1):!0},M=()=>{u("1");const T=C(B(lt)).format("YYYY-MM-DD HH:mm:ss");p(H=>$(H,q=>{q.settings.started_at=T})),o({open:!0,type:"create"})},z=async()=>{w(h,u)&&(await(h.id?A(h):D(h)),y(),o({open:!1}),u("1"),p(J(k)))},U=()=>{u("1"),o({open:!1}),d({}),p(J(k))},de=T=>{u(T)};return i(x,{children:[j,e&&a(K,{icon:a(Be,{size:12}),onClick:M,size:"large",type:"primary",children:e}),a(_e,{centered:!0,confirmLoading:m||_,footer:i(Y,{children:[a("div",{className:"pr-2",children:a(Me,{type:"message"})}),a(K,{onClick:U,children:s("Cancel")},"back"),a(K,{loading:m||_,onClick:z,type:"primary",children:h.id?"Update":"Create"},"Ok")]}),maskClosable:!1,onCancel:U,open:t.open,styles:{body:{marginInline:-24,maxHeight:"calc(100vh - 160px)",overflow:"auto"}},title:t.type?it[t.type]:"",width:S==="3"?800:600,children:a(nt,{handleTabActive:de,tabActive:S,token:c})},`hello ${g}`)]})}export{Pt as C,Oe as u};
