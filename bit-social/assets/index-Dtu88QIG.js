import{r as q,u as H,b as W,a as h,j as a,L as I,F as j,k as X,l as $}from"./main-afraid-ants-sort.js";import{C as Y}from"./CronWarning-BElqp4cS.js";import{D as U,R as Z}from"./Refresh-C564NUp4.js";import{a as K,b as J,u as ee,k as te}from"./react-query-BAnB2mAm.js";import{r as b,B as C,S as w,n as D,q as ae,u as E,M as se,p as A,v as le,F as Q,T as V,e as oe,P as ne,w as ce,l as re}from"./antd-CMhliQbc.js";import{u as ie}from"./router-yX2GsLRQ.js";import{u as he}from"./useSchedules-BjQaSL4n.js";import"./css-in-js-5B1lZlTz.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function ue(e,t){const n=K(),{isPending:l,mutateAsync:s}=J({mutationFn:async c=>q("logs/destroy/batch",{logIds:c},void 0,"POST"),onSuccess:()=>{n.invalidateQueries({queryKey:["logs",[t,e]]})}});return{deleteLogs:c=>s(c),isLogsDeleting:l}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function de(e,t,n){const{data:l,isFetched:s,isFetching:c,isLoading:r,refetch:d}=ee({enabled:!!t&&!!e,placeholderData:te,queryFn:async()=>q(`logs/${e}/${t}`,void 0,{...n},"GET"),queryKey:["logs",[e,t]],refetchInterval:3e3}),{current_page:p,current_total:v,data:f,pages:S,per_page:T,total:g}=(l==null?void 0:l.data)||{};return{currentPage:p,currentTotal:v,isFetched:s,isFetching:c,isLogsLoading:r,logData:f||[],perPage:T,refetch:d,totalLogs:g,totalPages:S}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function ge(){const e=K(),{data:t,isPending:n,mutateAsync:l}=J({mutationFn:async s=>q("retry",{...s},void 0,"POST"),onSuccess:()=>{e.invalidateQueries({queryKey:["logs"]})}});return{isRetryLoading:n,result:t,retry:s=>l(s)}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const pe=(e,t)=>{const n=Object.keys(e),l=Object.keys(t);return n.length!==l.length?!1:n.every(s=>e[s]===t[s])};function fe({filters:e,setFilters:t}){const[n,l]=b.useState(!1),[s,c]=b.useState(e),[r,d]=b.useState(),{schedules:p}=he(),{isProClient:v}=H(W),f=()=>{l(!0)},S=()=>{t({...s}),l(!1)},T=()=>{c(e),l(!1)},g=(i,P)=>{c(k=>({...k,[i]:P}))},L=[{label:"All",value:"all"},{label:"Facebook",value:"facebook"},{label:"Linkedin",value:"linkedin"}],R=[{label:"Google Business Profile",value:"googleBusinessProfile"},{label:"Pinterest",value:"pinterest"},{label:"Discord",value:"discord"},{label:"Tumblr",value:"tumblr"},{label:"X (twitter)",value:"twitter"}],x=v?[...L,...R]:L,m=p==null?void 0:p.map(i=>({label:i.name,value:String(i.id)})),O=[{label:"All",value:"all"},...m],F=i=>(P,k)=>{if(Array.isArray(k)&&k.every(z=>z===""))return g(i,"all");d(P),g(i,JSON.stringify(k))},M=()=>{d(void 0),c({...N})},_=pe(N,s)?"Ok":"Filter";return h(j,{children:[a(w,{children:a(C,{icon:a(I,{name:"filter",size:12}),onClick:f,size:"large",children:"Filter"})}),a(se,{footer:[a(C,{onClick:M,children:"Reset"},"reset"),a(C,{onClick:S,type:"primary",children:_},"ok")],maskClosable:!1,onCancel:T,onOk:S,open:n,title:"Logs filter",width:600,children:h(D,{layout:"vertical",children:[a(D.Item,{label:"Date",children:a(ae.RangePicker,{className:"w-100",onChange:F("date"),value:r})}),a(D.Item,{label:"Status",children:a(E,{defaultValue:"all",onChange:i=>g("status",i),options:[{label:"All",value:"all"},{label:"Success",value:"1"},{label:"Error",value:"2"}],value:s.status})}),a(D.Item,{label:"Schedule",children:a(E,{defaultValue:"all",onChange:i=>g("schedule",i),options:O,value:s.schedule})}),a(D.Item,{label:"Platform",children:a(E,{defaultValue:"all",onChange:i=>g("platform",i),options:x,value:s.platform})})]})})]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const B={1:"success",2:"error"};function me({filters:e}){const{platform:t,schedule:n,status:l}=e,s=e.date==="all"?!1:JSON.parse(e.date);return h(w,{size:"small",children:["Filter:",s&&h(A,{color:"purple",children:["Date: ",s[0]," to ",s[1]]}),l!=="all"&&h(A,{color:B[l],children:["Status: ",B[l]]}),n!=="all"&&h(A,{color:"orange",children:["Schedule: ",n," "]}),t!=="all"&&h(A,{color:"geekblue",children:["Platform: ",t]})]})}const ye="_expandDetails_vflxa_1",be={expandDetails:ye};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Ce=(e,t,n)=>{e.stopPropagation(),n(t)},{Paragraph:Se,Text:ke}=V,Ae=(e,t)=>[{dataIndex:"date",key:"date",title:"Date",width:"15%"},{dataIndex:"platform",key:"platform",title:"Platform"},{dataIndex:"account",key:"account",title:"Account"},{dataIndex:"schedule",key:"schedule",title:"Schedule",width:"20%"},{dataIndex:"details",key:"details",render:(l,{details:s,status:c})=>{const d=JSON.stringify(s);return h(Q,{align:"center",children:[c==="1"?a(A,{color:"success",children:"Success"}):a(A,{color:"error",children:"Error"}),a(Se,{copyable:{text:d},ellipsis:!0,style:{marginBottom:0},children:d})]})},title:"Response",width:"20%"},{dataIndex:"actions",key:"actions",render:(l,{details:s,key:c,scheduleId:r,status:d})=>a(j,{children:d==="1"?a(C,{href:s==null?void 0:s.post_url,icon:a(I,{name:"external-link",size:13}),size:"small",target:"_blank",children:"Visit"}):a(C,{danger:!0,disabled:t||!r,icon:a(I,{name:"repeat",size:13}),onClick:p=>Ce(p,{details:s,key:c,scheduleId:r},e),size:"small",title:r?"Retry":"Related schedule was deleted",children:"Retry"})}),title:"Actions"}],N={date:"all",platform:"all",schedule:"all",scheduleId:"all",status:"all"},ve=e=>a(re,{description:a("pre",{className:be.expandDetails,children:JSON.stringify(e.details,void 0,2)}),message:e.status==="1"?"Success":"Error",showIcon:!0,type:e.status==="1"?"success":"error"}),Te=({expanded:e,onExpand:t,record:n})=>a(C,{onClick:l=>t(n,l),size:"small",children:e?"Hide":"Details"}),xe={expandedRowRender:ve,expandIcon:Te,expandIconAsCell:!0,expandIconColumnIndex:6};function Oe(){const[e,t]=ie({}),n=Number(e.get("page"))||1,l=Number(e.get("limit"))||10,[s,c]=b.useState([]),[r,d]=b.useState(N),{isFetching:p,isLogsLoading:v,logData:f,refetch:S,totalLogs:T,totalPages:g}=de(n,l,r),{deleteLogs:L,isLogsDeleting:R}=ue(l,n),{isRetryLoading:x,result:m,retry:O}=ge(),[F,M]=le.useMessage();b.useEffect(()=>{if(!x&&(m==null?void 0:m.status)==="success")return F.open({content:"Retry call successfully",type:"success"});if(!x&&(m==null?void 0:m.status)==="error")return F.open({content:"Retry call successfully",type:"success"})},[m]);const _=s.length>0,i=f&&(f==null?void 0:f.map(o=>{var y;return{account:o.details.account_name,date:X(o.created_at,`${$.DATE_FORMAT} ${$.TIME_FORMAT}`),details:o.details,key:o.id,platform:o.platform,schedule:((y=o==null?void 0:o.schedule)==null?void 0:y.name)||`Auto post - Post ID: ${o.details.post_id}`,scheduleId:o.schedule_id,status:o.status}})),P={onSelect:(o,y)=>{if(o){if(y){c(u=>[...u,o.key]);return}c(u=>u.filter(G=>G!==o.key))}},onSelectAll:(o,y)=>{if(o){c(y.map(u=>u==null?void 0:u.key).filter(u=>u!==void 0));return}c([])}},k=async()=>{await L(s),c([])},z=(o,y)=>{t(u=>(u.set("page",String(o)),u.set("limit",String(y)),u))};return b.useEffect(()=>{S(),c([])},[r]),b.useEffect(()=>{!f.length&&g&&n>g&&t(o=>(o.set("page",String(g)),o))},[f,r]),h(j,{children:[h(Q,{className:"mb-2",justify:"space-between",children:[h(w,{children:[(v||R)&&a(oe,{}),_?h(j,{children:[a(ke,{children:`Selected ${s.length} items`}),a(ne,{description:"Are you sure to delete this logs?",okText:"Confirm",onConfirm:k,placement:"right",title:"Delete Logs",children:a(C,{danger:!0,icon:a(U,{}),type:"text"})})]}):void 0,Object.values(r).every(o=>o==="all")?void 0:a(me,{filters:r,setFilters:d})]}),h(w,{children:[h(V.Link,{href:"https://bit-social.com/docs/log/",rel:"noopener noreferrer",strong:!0,style:{fontSize:"18px"},target:"_blank",children:["Visit our documentation"," ",a(I,{name:"move-up-right",style:{transform:"translateY(-2px)"}})]}),a(C,{icon:a(Z,{spin:p}),loading:p,onClick:()=>S(),size:"large",children:"Refresh"}),a(fe,{filters:r,setFilters:d})]})]}),a(Y,{}),a(ce,{bordered:!0,className:"mt-1",columns:Ae(O,x),dataSource:i,expandable:xe,pagination:{current:n,defaultCurrent:1,onChange:z,pageSize:l,showSizeChanger:!0,total:T},rowSelection:P}),M]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};export{Oe as default};
