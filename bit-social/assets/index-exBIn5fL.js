import{r as $,u as W,b as X,_ as a,a as u,j as s,L as j,F as w,l as Y,m as B}from"./main-plenty-doors-read.js";import{C as U}from"./CronWarning-CwRxBjLQ.js";import{D as Z,R as ee}from"./Refresh-BuaHVLqa.js";import{a as J,b as Q,u as te,k as ae}from"./react-query-B4O-PG_a.js";import{r as C,B as S,S as R,o as I,u as se,v as N,M as le,q as A,w as oe,F as V,P as ne,T as G,x as ce,m as re,d as ie}from"./antd-Dkhz2BjJ.js";import{u as he}from"./router-BDBqwsZt.js";import{u as ue}from"./useSchedules-CBJ833Ec.js";import"./css-in-js-D9KZUreV.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function de(e,t){const c=J(),{isPending:o,mutateAsync:l}=Q({mutationFn:async r=>$("logs/destroy/batch",{logIds:r},void 0,"POST"),onSuccess:()=>{c.invalidateQueries({queryKey:["logs",[t,e]]})}});return{deleteLogs:r=>l(r),isLogsDeleting:o}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function ge(e,t,c){const{data:o,isFetched:l,isFetching:r,isLoading:i,refetch:g}=te({enabled:!!t&&!!e,placeholderData:ae,queryFn:async()=>$(`logs/${e}/${t}`,void 0,{...c},"GET"),queryKey:["logs",[e,t]],refetchInterval:3e3}),{current_page:m,current_total:T,data:f,pages:k,per_page:x,total:p}=(o==null?void 0:o.data)||{};return{currentPage:m,currentTotal:T,isFetched:l,isFetching:r,isLogsLoading:i,logData:f||[],perPage:x,refetch:g,totalLogs:p,totalPages:k}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function pe(){const e=J(),{data:t,isPending:c,mutateAsync:o}=Q({mutationFn:async l=>$("retry",{...l},void 0,"POST"),onSuccess:()=>{e.invalidateQueries({queryKey:["logs"]})}});return{isRetryLoading:c,result:t,retry:l=>o(l)}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const me=(e,t)=>{const c=Object.keys(e),o=Object.keys(t);return c.length!==o.length?!1:c.every(l=>e[l]===t[l])};function fe({filters:e,setFilters:t}){const[c,o]=C.useState(!1),[l,r]=C.useState(e),[i,g]=C.useState(),{schedules:m}=ue(),{isProClient:T}=W(X),f=()=>{o(!0)},k=()=>{t({...l}),o(!1)},x=()=>{r(e),o(!1)},p=(h,D)=>{r(v=>({...v,[h]:D}))},L=[{label:a("All"),value:"all"},{label:a("Facebook"),value:"facebook"},{label:a("Linkedin"),value:"linkedin"}],O=[{label:a("Google Business Profile"),value:"googleBusinessProfile"},{label:a("Pinterest"),value:"pinterest"},{label:a("Discord"),value:"discord"},{label:a("Tumblr"),value:"tumblr"},{label:a("X (twitter)"),value:"twitter"},{label:a("Instagram"),value:"instagram"}],P=T?[...L,...O]:L,y=m==null?void 0:m.map(h=>({label:h.name,value:String(h.id)})),_=[{label:a("All"),value:"all"},...y],F=h=>(D,v)=>{if(Array.isArray(v)&&v.every(E=>E===""))return p(h,"all");g(D),p(h,JSON.stringify(v))},M=()=>{g(void 0),r({...q})},z=me(q,l)?"Ok":"Filter";return u(w,{children:[s(R,{children:s(S,{icon:s(j,{name:"filter",size:12}),onClick:f,size:"large",children:a("Filter")})}),s(le,{footer:[s(S,{onClick:M,children:a("Reset")},"reset"),s(S,{onClick:k,type:"primary",children:z},"ok")],maskClosable:!1,onCancel:x,onOk:k,open:c,title:a("Logs filter"),width:600,children:u(I,{layout:"vertical",children:[s(I.Item,{label:a("Date"),children:s(se.RangePicker,{className:"w-100",onChange:F("date"),value:i})}),s(I.Item,{label:a("Status"),children:s(N,{defaultValue:"all",onChange:h=>p("status",h),options:[{label:a("All"),value:"all"},{label:a("Success"),value:"1"},{label:a("Error"),value:"2"}],value:l.status})}),s(I.Item,{label:a("Schedule"),children:s(N,{defaultValue:"all",onChange:h=>p("schedule",h),options:_,value:l.schedule})}),s(I.Item,{label:a("Platform"),children:s(N,{defaultValue:"all",onChange:h=>p("platform",h),options:P,value:l.platform})})]})})]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const K={1:"success",2:"error"};function ye({filters:e}){const{platform:t,schedule:c,status:o}=e,l=e.date==="all"?!1:JSON.parse(e.date);return u(R,{size:"small",children:[a("Filter:"),l&&u(A,{color:"purple",children:[a("Date"),": ",l[0]," ",a("to")," ",l[1]]}),o!=="all"&&u(A,{color:K[o],children:[a("Status"),": ",K[o]]}),c!=="all"&&u(A,{color:"orange",children:[a("Schedule"),": ",c," "]}),t!=="all"&&u(A,{color:"geekblue",children:[a("Platform"),": ",t]})]})}const be="_expandDetails_vflxa_1",Ce={expandDetails:be};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Se=(e,t,c)=>{e.stopPropagation(),c(t)},{Paragraph:ke,Text:ve}=G,Ae=(e,t)=>[{dataIndex:"date",key:"date",title:a("Date"),width:"15%"},{dataIndex:"platform",key:"platform",title:a("Platform")},{dataIndex:"account",key:"account",title:a("Account")},{dataIndex:"schedule",key:"schedule",title:a("Schedule"),width:"20%"},{dataIndex:"details",key:"details",render:(o,{details:l,status:r})=>{const g=JSON.stringify(l);return u(V,{align:"center",children:[r==="1"?s(A,{color:"success",children:a("Success")}):s(A,{color:"error",children:a("Error")}),s(ke,{copyable:{text:g},ellipsis:!0,style:{marginBottom:0},children:g})]})},title:a("Response"),width:"20%"},{dataIndex:"actions",key:"actions",render:(o,{details:l,key:r,scheduleId:i,status:g})=>s(w,{children:g==="1"?s(S,{href:l==null?void 0:l.post_url,icon:s(j,{name:"external-link",size:13}),size:"small",target:"_blank",children:a("Visit")}):s(S,{danger:!0,disabled:t||!i,icon:s(j,{name:"repeat",size:13}),onClick:m=>Se(m,{details:l,key:r,scheduleId:i},e),size:"small",title:i?a("Retry"):a("Related schedule was deleted"),children:a("Retry")})}),title:a("Actions")}],q={date:"all",platform:"all",schedule:"all",scheduleId:"all",status:"all"},Te=e=>s(re,{description:s("pre",{className:Ce.expandDetails,children:JSON.stringify(e.details,void 0,2)}),message:e.status==="1"?"Success":"Error",showIcon:!0,type:e.status==="1"?"success":"error"}),xe=({expanded:e,onExpand:t,record:c})=>s(S,{onClick:o=>t(c,o),size:"small",children:e?a("Hide"):a("Details")}),Pe={expandedRowRender:Te,expandIcon:xe,expandIconAsCell:!0,expandIconColumnIndex:6};function _e(){const[e,t]=he({}),c=Number(e.get("page"))||1,o=Number(e.get("limit"))||10,[l,r]=C.useState([]),[i,g]=C.useState(q),{isFetching:m,isLogsLoading:T,logData:f,refetch:k,totalLogs:x,totalPages:p}=ge(c,o,i),{deleteLogs:L,isLogsDeleting:O}=de(o,c),{isRetryLoading:P,result:y,retry:_}=pe(),[F,M]=oe.useMessage();C.useEffect(()=>{if(!P&&(y==null?void 0:y.status)==="success")return F.open({content:"Retry call successfully",type:"success"});if(!P&&(y==null?void 0:y.status)==="error")return F.open({content:"Retry call successfully",type:"success"})},[y]);const z=l.length>0,h=f&&(f==null?void 0:f.map(n=>{var b;return{account:n.details.account_name,date:Y(n.created_at,`${B.DATE_FORMAT} ${B.TIME_FORMAT}`),details:n.details,key:n.id,platform:n.platform,schedule:((b=n==null?void 0:n.schedule)==null?void 0:b.name)||`Auto post - Post ID: ${n.details.post_id}`,scheduleId:n.schedule_id,status:n.status}})),D={onSelect:(n,b)=>{if(n){if(b){r(d=>[...d,n.key]);return}r(d=>d.filter(H=>H!==n.key))}},onSelectAll:(n,b)=>{if(n){r(b.map(d=>d==null?void 0:d.key).filter(d=>d!==void 0));return}r([])}},v=async()=>{await L(l),r([])},E=(n,b)=>{t(d=>(d.set("page",String(n)),d.set("limit",String(b)),d))};return C.useEffect(()=>{k(),r([])},[i]),C.useEffect(()=>{!f.length&&p&&c>p&&t(n=>(n.set("page",String(p)),n))},[f,i]),u(w,{children:[u(V,{className:"mb-2",justify:"space-between",children:[u(R,{children:[(T||O)&&s(ie,{}),z?u(w,{children:[s(ve,{children:`Selected ${l.length} items`}),s(ne,{description:a("Are you sure to delete this logs?"),okText:a("Confirm"),onConfirm:v,placement:"right",title:a("Delete Logs"),children:s(S,{danger:!0,icon:s(Z,{}),type:"text"})})]}):void 0,Object.values(i).every(n=>n==="all")?void 0:s(ye,{filters:i,setFilters:g})]}),u(R,{children:[u(G.Link,{href:"https://bit-social.com/docs/log/",rel:"noopener noreferrer",strong:!0,style:{fontSize:"18px"},target:"_blank",children:[a("Visit our documentation"),s(j,{name:"move-up-right",style:{transform:"translateY(-2px)"}})]}),s(S,{icon:s(ee,{spin:m}),loading:m,onClick:()=>k(),size:"large",children:a("Refresh")}),s(fe,{filters:i,setFilters:g})]})]}),s(U,{}),s(ce,{bordered:!0,className:"mt-1",columns:Ae(_,P),dataSource:h,expandable:Pe,pagination:{current:c,defaultCurrent:1,onChange:E,pageSize:o,showSizeChanger:!0,total:x},rowSelection:D}),M]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};export{_e as default};
