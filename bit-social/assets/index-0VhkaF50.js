import{Z as X,q,v as V,w as z,ac as Y,ad as Z,a0 as B,r as v,A as E,D as J,E as ee,z as a,y as g,j as s,B as A,ae as te,S as j,N as ae,F as I,af as se,T as Q,ag as oe,ah as le,ai as $,aj as re,J as ce}from"./main-many-times-fetch.js";import{C as ie}from"./CronWarning-Ct7Hns4e.js";import{D as ne,R as he,F as ue}from"./Refresh-Cf5ex4ZK.js";import{u as de}from"./useSchedules-BuWp2vO1.js";import{F as L,P as ge}from"./index-mcIkmG-z.js";import{D as pe}from"./index-aT-UGJqw.js";import{S as O}from"./index-Cd0SFHu0.js";import{T as x}from"./index-DPlqffl7.js";import{s as me}from"./index-zM7Vk6l9.js";import{F as K}from"./index-DaSuuuc_.js";import{A as fe}from"./index-BekAJkrL.js";import"./addEventListener-DtRRl-r9.js";import"./index-DQgpIDqu.js";import"./index-C0j1u0Gd.js";import"./collapse-BbEVqHco.js";import"./index-BUi_02KP.js";import"./index-vEWfQLKT.js";import"./LeftOutlined-0yeDixaA.js";import"./Dropdown-CvuR3rEB.js";import"./index-Dq_mWrxL.js";import"./EllipsisOutlined-BtzbaDwq.js";import"./move-CHk6SDYf.js";import"./index-CpoZDOLx.js";import"./row-DOFoqLwk.js";import"./AntIconWrapper-BncwqkeK.js";import"./EyeOutlined-BAMNGOAV.js";import"./context-DShoETyn.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const G={date:"all",platform:"all",schedule:"all",scheduleId:"all",status:"all"},w=globalThis.jotaiAtomCache.get("/home/runner/work/bit-social/bit-social/frontend/src/common/globalStates/$logFilter.ts/$logFilter",X(G));w.debugLabel="$logFilter";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function be(e,t){const i=q(),{isPending:c,mutateAsync:l}=V({mutationFn:async r=>z("logs/destroy/batch",{logIds:r},void 0,"POST"),onSuccess:()=>{i.invalidateQueries({queryKey:["logs",[t,e]]})}});return{deleteLogs:r=>l(r),isLogsDeleting:c}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function ye(e,t,i){const{data:c,isFetched:l,isFetching:r,isLoading:n,refetch:h}=Y({enabled:!!t&&!!e,placeholderData:Z,queryFn:async()=>z(`logs/${e}/${t}`,void 0,{...i},"GET"),queryKey:["logs",[e,t]],refetchInterval:3e3}),{current_page:f,current_total:u,data:T,pages:b,per_page:C,total:P}=(c==null?void 0:c.data)||{};return{currentPage:f,currentTotal:u,isFetched:l,isFetching:r,isLogsLoading:n,logData:T||[],perPage:C,refetch:h,totalLogs:P,totalPages:b}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Ce(){const e=q(),{data:t,isPending:i,mutateAsync:c}=V({mutationFn:async l=>z("retry",{...l},void 0,"POST"),onSuccess:()=>{e.invalidateQueries({queryKey:["logs"]})}});return{isRetryLoading:i,result:t,retry:l=>c(l)}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Se(){const[e,t]=B(w),[i,c]=v.useState(!1),[,l]=E({}),[r,n]=v.useState(),{schedules:h}=de(),{isProClient:f}=J(ee),u=()=>{c(!0)},T=()=>{t(e),c(!1)},b=(d,k)=>{t(m=>({...m,[d]:k})),l(m=>(m.set("page","1"),m))},C=[{label:a("All"),value:"all"},{label:a("Facebook"),value:"facebook"},{label:a("Linkedin"),value:"linkedin"}],P=[{label:a("Google Business Profile"),value:"googleBusinessProfile"},{label:a("Pinterest"),value:"pinterest"},{label:a("Discord"),value:"discord"},{label:a("Tumblr"),value:"tumblr"},{label:a("X (twitter)"),value:"twitter"},{label:a("Instagram"),value:"instagram"}],R=f?[...C,...P]:C,F=h==null?void 0:h.map(d=>({label:d.name,value:String(d.id)})),y=[{label:a("All"),value:"all"},...F],M=d=>(k,m)=>{if(Array.isArray(m)&&m.every(_=>_===""))return b(d,"all");n(k),b(d,JSON.stringify(m))},D=()=>{n(void 0),t(G)};return g(I,{children:[s(j,{children:s(A,{icon:s(te,{size:12}),onClick:u,size:"large",children:a("Filter")})}),s(ae,{footer:[s(A,{onClick:D,type:"primary",children:a("Reset")},"reset")],onCancel:T,open:i,title:a("Logs filter"),width:600,children:g(L,{layout:"vertical",children:[s(L.Item,{label:a("Date"),children:s(pe.RangePicker,{className:"w-100",onChange:M("date"),value:r})}),s(L.Item,{label:a("Status"),children:s(O,{defaultValue:"all",onChange:d=>b("status",d),options:[{label:a("All"),value:"all"},{label:a("Success"),value:"1"},{label:a("Error"),value:"0"}],value:e.status})}),s(L.Item,{label:a("Schedule"),children:s(O,{defaultValue:"all",onChange:d=>b("schedule",d),options:y,value:e.schedule})}),s(L.Item,{label:a("Platform"),children:s(O,{defaultValue:"all",onChange:d=>b("platform",d),options:R,value:e.platform})})]})})]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const N={0:"error",1:"success"};function Ae(){const[e,t]=B(w),[,i]=E({}),{platform:c,schedule:l,status:r}=e,n=e.date==="all"?!1:JSON.parse(e.date),h=f=>{t(u=>({...u,[f]:"all"})),i(u=>(u.set("page","1"),u))};return g(j,{size:"small",children:[a("Filter:"),n&&g(x,{closable:!0,color:"purple",onClose:()=>h("date"),children:[a("Date"),": ",n[0]," ",a("to")," ",n[1]]}),r!=="all"&&g(x,{closeIcon:!0,color:N[r],onClose:()=>h("status"),children:[a("Status"),": ",N[r]]}),l!=="all"&&g(x,{closable:!0,color:"orange",onClose:()=>h("schedule"),children:[a("Schedule"),": ",l," "]}),c!=="all"&&g(x,{closable:!0,color:"geekblue",onClose:()=>h("platform"),children:[a("Platform"),": ",c]})]})}const Te="_expandDetails_vflxa_1",ve={expandDetails:Te};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const xe=(e,t,i)=>{e.stopPropagation(),i(t)},{Paragraph:Pe,Text:Fe}=Q,ke=(e,t)=>[{dataIndex:"date",key:"date",title:a("Date"),width:"15%"},{dataIndex:"platform",key:"platform",title:a("Platform")},{dataIndex:"account",key:"account",title:a("Account")},{dataIndex:"schedule",key:"schedule",title:a("Schedule"),width:"20%"},{dataIndex:"details",key:"details",render:(c,{details:l,status:r})=>{const h=JSON.stringify(l);return g(K,{align:"center",children:[r==="1"?s(x,{color:"success",children:a("Success")}):s(x,{color:"error",children:a("Error")}),s(Pe,{copyable:{text:h},style:{marginBottom:0},children:h.slice(0,20)})]})},title:a("Response"),width:"20%"},{dataIndex:"actions",key:"actions",render:(c,{details:l,key:r,scheduleId:n,status:h})=>s(I,{children:h==="1"?s(A,{href:l==null?void 0:l.post_url,icon:s(oe,{size:13}),size:"small",target:"_blank",children:a("Visit")}):s(A,{danger:!0,disabled:t||!n,icon:s(le,{size:13}),onClick:f=>xe(f,{details:l,key:r,scheduleId:n},e),size:"small",title:n?a("Retry"):a("Related schedule was deleted"),children:a("Retry")})}),title:a("Actions")}],Le=e=>s(fe,{description:s("pre",{className:ve.expandDetails,children:JSON.stringify(e.details,void 0,2)}),message:e.status==="1"?"Success":"Error",showIcon:!0,type:e.status==="1"?"success":"error"}),De=({expanded:e,onExpand:t,record:i})=>s(A,{onClick:c=>t(i,c),size:"small",children:e?a("Hide"):a("Details")}),je={expandedRowRender:Le,expandIcon:De,expandIconAsCell:!0,expandIconColumnIndex:6};function ot(){const[e,t]=E({}),i=Number(e.get("page"))||1,c=Number(e.get("limit"))||10,[l,r]=v.useState([]),n=J(w),{isFetching:h,isLogsLoading:f,logData:u,refetch:T,totalLogs:b,totalPages:C}=ye(i,c,n),{deleteLogs:P,isLogsDeleting:R}=be(c,i),{isRetryLoading:F,result:y,retry:M}=Ce(),[D,d]=me.useMessage();v.useEffect(()=>{if(!F&&(y==null?void 0:y.status)==="success")return D.open({content:"Retry call successfully",type:"success"});if(!F&&(y==null?void 0:y.status)==="error")return D.open({content:"Retry call successfully",type:"success"})},[y]);const k=l.length>0,m=u&&(u==null?void 0:u.map(o=>{var S;return{account:o.details.account_name,date:se(o.created_at,`${$.DATE_FORMAT} ${$.TIME_FORMAT}`),details:o.details,key:o.id,platform:o.platform,schedule:((S=o==null?void 0:o.schedule)==null?void 0:S.name)||`Auto post - Post ID: ${o.details.post_id}`,scheduleId:o.schedule_id,status:o.status}})),_={onSelect:(o,S)=>{if(o){if(S){r(p=>[...p,o.key]);return}r(p=>p.filter(W=>W!==o.key))}},onSelectAll:(o,S)=>{if(o){r(S.map(p=>p==null?void 0:p.key).filter(p=>p!==void 0));return}r([])}},H=async()=>{await P(l),r([])},U=(o,S)=>{t(p=>(p.set("page",String(o)),p.set("limit",String(S)),p))};return v.useEffect(()=>{T(),r([])},[n]),v.useEffect(()=>{!u.length&&C&&i>C&&t(o=>(o.set("page",String(C)),o))},[u,n]),g(I,{children:[g(K,{className:"mb-2",justify:"space-between",children:[g(j,{children:[(f||R)&&s(re,{}),k?g(I,{children:[s(Fe,{children:`Selected ${l.length} items`}),s(ge,{description:a("Are you sure to delete this logs?"),okText:a("Confirm"),onConfirm:H,placement:"right",title:a("Delete Logs"),children:s(A,{danger:!0,icon:s(ne,{}),type:"text"})})]}):void 0,Object.values(n).every(o=>o==="all")?void 0:s(Ae,{})]}),g(j,{children:[g(Q.Link,{href:"https://bit-social.com/docs/log/",rel:"noopener noreferrer",strong:!0,style:{fontSize:"18px"},target:"_blank",children:[a("Visit our documentation"),s(ce,{style:{transform:"translateY(-2px)"}})]}),s(A,{icon:s(he,{spin:h}),loading:h,onClick:()=>T(),size:"large",children:a("Refresh")}),s(Se,{})]})]}),s(ie,{}),s(ue,{bordered:!0,className:"mt-1",columns:ke(M,F),dataSource:m,expandable:je,pagination:{current:i,defaultCurrent:1,onChange:U,pageSize:c,showSizeChanger:!0,total:b},rowSelection:_}),d]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};export{ot as default};
