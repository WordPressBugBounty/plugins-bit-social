import{r as oe,c as ie,h as re,g as ne,e as ce,k as j,m as le,a as c,j as s,F as v,L as f,l as x,p as de}from"./main-afraid-ants-sort.js";import{u as ue,t as he,$ as ge,a as pe}from"./DatePicker-BZ3Wqgt0.js";import{u as me}from"./useDebounce-CTDTCsll.js";import{C as Se}from"./CronWarning-BElqp4cS.js";import{u as fe,N as xe}from"./useUpdateScheduleStatus-DLEkdW5O.js";import{u as Te,C as D}from"./CreateScheduleModal-DoeNFU8h.js";import{R as ye,D as be}from"./Refresh-C564NUp4.js";import{r as T,s as Ce,y as E,F as _e,S as I,T as k,B as y,I as Ae,P as $,m as ve,w as Ie,E as ke,p as F,u as Pe}from"./antd-CMhliQbc.js";import{u as Ee}from"./router-yX2GsLRQ.js";import{a as we,b as Me}from"./react-query-BAnB2mAm.js";import"./css-in-js-5B1lZlTz.js";import"./_socialTemplates-CRuryL5C.js";import"./PlatformIcon-DHlKQsTj.js";import"./useIntervalTypes-DAAt_mng.js";import"./groupHelper-PveggK-o.js";import"./index-Bxjp1ha4.js";import"./useSocialTemplates-DLinxB78.js";import"./usePostTypes-CNLK-mKL.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,i){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,i),i)}};function Ne(){const t=we(),{isPending:i,isSuccess:u,mutateAsync:g}=Me({mutationFn:async l=>{if(!l.length)throw new Error("Schedule ID is undefined");return oe("schedule/destroy",{scheduleIds:l},void 0,"POST")},onSuccess:()=>{t.invalidateQueries({queryKey:["get-calendar-schedules"]}),t.invalidateQueries({queryKey:["all-schedules"]})}});return{deleteSchedule:l=>g(l),deleteScheduleLoading:i,deleteScheduleSuccess:u}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,i){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,i),i)}};E.extend(ue);E.extend(he);const je=({token:t})=>({background:t.colorSuccessBg,border:`1px solid ${t.colorSuccessBorder}`,borderRadius:"10px",color:t.colorSuccessText,minWidth:"90px"}),De=({token:t})=>({background:t.colorWarningBg,border:`1px solid ${t.colorWarningBorder}`,borderRadius:"10px",color:t.colorWarningText,minWidth:"90px"}),h=1,P=0,L=2;function Xe(){const[t,i]=Ee(),u=Number(t.get("page"))||1,g=Number(t.get("limit"))||10,[l,b]=T.useState({open:!1,type:"Create"}),[C,p]=T.useState([]),R=ie(ge),[w,z]=re(pe),d=me(w,300),{isFetchingSchedules:M,isLoadingSchedules:_,refetchSchedules:S,scheduleData:r,totalPages:A,totalSchedule:B}=Te(d,u,g),{deleteSchedule:N,deleteScheduleLoading:O}=Ne(),{updateScheduleStatus:W}=fe(),[U,q]=Ce.useNotification(),{timeZone:H}=ne(ce),Q=(e,o="success")=>{U[o]({description:e,message:"Share Now"})},Y=(e,o)=>{i(a=>(a.set("page",String(e)),a.set("limit",String(o)),a))},K=e=>{const o=r.find(a=>a.id===e);o&&(R(de(o.config,a=>{a.id=o.id})),b({open:!0,type:"Edit"}))},V=e=>{z(e.target.value)},Z=async()=>{await N(C),p([]),S()},G=async e=>{await N([e]),S()},J=async(e,o)=>{const{data:a,status:n}=await W({id:e,status:o});Q(a,n),S()},X=[{dataIndex:"title",key:"title",title:"Title",width:"20%"},{dataIndex:"created_at",key:"created_at",title:"Created At"},{dataIndex:"start",key:"start",title:"Start Scheduled Post"},{dataIndex:"interval",key:"interval",render:(e,{interval:o})=>{var a;return(a=o.settings)!=null&&a.post_interval_value?s(k.Text,{children:`${o.settings.post_interval_value}  ${o.settings.post_interval_type}`}):"-"},title:"Interval "},{dataIndex:"nextPost",key:"nextPost",title:"Next Post "},{dataIndex:"status",key:"status",render:(e,{interval:o,key:a,status:n})=>{var m;if(!((m=o.settings)!=null&&m.post_interval_value)&&n===h)return s(F,{color:"green",children:"In Progress"});switch(n){case L:return s(F,{color:"grey",children:"Completed"});case h:case P:return s(Pe,{css:n===h?je:De,onChange:se=>J(a,Number(se)),options:[{disabled:n===h,label:"Active",value:h},{disabled:n===P,label:"Paused",value:P}],size:"small",value:n===h?"Active":"Paused",variant:"borderless"})}},title:"Status"},{dataIndex:"action",key:"action",render:(e,{interval:o,key:a,status:n})=>{var m;return c(I,{direction:"horizontal",children:[((m=o.settings)==null?void 0:m.post_interval_value)&&n!==L&&s(y,{icon:s(f,{name:"pencil"}),onClick:()=>K(a),type:"text"}),s($,{description:"Are you sure you want to delete this schedule?",okButtonProps:{danger:!0,loading:O},okText:"Yes, Delete",onConfirm:()=>G(a),placement:"right",title:"Delete?",children:s(y,{danger:!0,icon:s(f,{name:"trash-2"}),type:"text"})})]})},title:"Action "}],ee=r&&r.map(e=>({created_at:j(e.created_at,`${x.DATE_FORMAT} ${x.TIME_FORMAT}`),interval:e.config,key:e.id,nextPost:e.next_published_at&&e.status===1&&E(e.next_published_at).diff(le(H))>1?e.human_readable_next_publish:"-",start:e!=null&&e.started_at?j(e.started_at,`${x.DATE_FORMAT} ${x.TIME_FORMAT}`):"-",status:e.status,title:e.name})),te={onSelect:(e,o)=>{if(e){if(o){p(a=>[...a,e.key]);return}p(a=>a.filter(n=>n!==e.key))}},onSelectAll:(e,o)=>{if(e){p(o.map(a=>a==null?void 0:a.key).filter(a=>a!==void 0));return}p([])}},ae=C.length>0;return T.useEffect(()=>{i(e=>(e.set("page",String(u)),e.set("limit",String(g)),e))},[d]),T.useEffect(()=>{!r.length&&A&&u>A&&i(e=>(e.set("page",String(A)),e))},[r]),c(v,{children:[q,c(_e,{className:"mb-1",justify:"space-between",children:[c(I,{children:[!d&&r.length||d?s(Ae,{onChange:V,placeholder:"Search schedule",prefix:s(f,{name:"search"}),value:w}):void 0,ae?c(v,{children:[s(k.Text,{children:`Selected ${C.length} items`}),s($,{description:"Are you sure to delete this logs?",okButtonProps:{danger:!0},okText:"Yes, Delete",onConfirm:Z,placement:"right",title:"Delete Logs",children:s(y,{className:"ml-2",danger:!0,icon:s(be,{}),type:"text"})})]}):void 0]}),s("div",{children:!d&&r.length||d?c(I,{children:[c(k.Link,{href:"https://bit-social.com/docs/schedule-wordpress-posts-on-social-media/",rel:"noopener noreferrer",strong:!0,style:{fontSize:"18px"},target:"_blank",children:["How to create schedule"," ",s(f,{name:"move-up-right",style:{transform:"translateY(-2px)"}})]}),s(y,{disabled:M,icon:s(ye,{spin:M}),onClick:()=>S(),size:"large",children:"Refresh"}),s(D,{btnTitle:"Create Schedule",isScheduleModalOpen:l,setIsScheduleModalOpen:b})]}):void 0})]}),_&&s(ve,{}),r!=null&&r.length?c(v,{children:[s(Se,{}),s(Ie,{bordered:!0,className:"mt-1",columns:X,dataSource:ee,pagination:{current:u,defaultCurrent:1,onChange:Y,pageSize:g,showSizeChanger:!0,total:B},rowSelection:te})]}):void 0,!_&&!(r!=null&&r.length)?s(ke,{description:"No schedule found!",children:!d&&s(D,{btnTitle:"Create Schedule",isScheduleModalOpen:l,setIsScheduleModalOpen:b})}):void 0,!_&&!(r!=null&&r.length)?s(xe,{fontSize:"1.6rem",section:"schedule",style:{marginTop:"30px",textAlign:"justify"}}):void 0]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,i){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,i),i)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,i){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,i),i)}};export{Xe as default};
