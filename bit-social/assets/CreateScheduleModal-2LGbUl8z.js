import{r as z,j as a,a as c,A as ye,h as x,F as H,_ as L,p as q,u as re,b as fe,c as be,d as Ce,L as _e,g as ie,e as ce,o as ve,n as K,q as Te}from"./main-some-women-speak.js";import{$ as W,T as Ae,b as le,D as Se,u as we,t as Pe,d as te,a as De}from"./DatePicker-CqphXXkq.js";import{$ as ke}from"./_socialTemplates-Dn3A61Ix.js";import{C as je}from"./CronWarning-BDlyjNsw.js";import{u as he,a as Ie,b as G}from"./react-query-B4O-PG_a.js";import{u as Fe}from"./useSocialTemplates-OyCNOoJb.js";import{r as E,F as Me,T as U,j as ae,k as Le,t as ue,o as C,v as Y,z as _,u as Ye,w as de,I as se,S as O,m as xe,G as $e,H as Ee,B as V,M as He}from"./antd-Dkhz2BjJ.js";import{u as qe}from"./router-BDBqwsZt.js";import{a as pe}from"./css-in-js-D9KZUreV.js";import{u as Be,C as oe}from"./groupHelper-LXyWAMdx.js";import{F as Ne,A as Oe,u as ze}from"./useIntervalTypes-Dy4Aw593.js";import{u as Re}from"./usePostTypes-Cc3A4lmY.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Ke(e,t,s){const{data:l,isFetching:u,isLoading:g,refetch:m}=he({queryFn:async()=>z(`schedule/${e}${e?"/":""}${t}/${s}`,void 0,void 0,"GET"),queryKey:[`get-schedules-${e}`,[t,s]],refetchInterval:5e3}),{current_page:w,current_total:d,data:k,pages:y,per_page:T,total:P}=(l==null?void 0:l.data)||{};return{currentPage:w,currentTotal:d,isFetchingSchedules:u,isLoadingSchedules:g,perPage:T,refetchSchedules:m,scheduleData:k||[],totalPages:y,totalSchedule:P}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function We({className:e,size:t="1em",stroke:s=2}){return a(ye,{children:c("svg",{className:`svgIcn ${e}`,fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:s,viewBox:"0 0 24 24",width:t,children:[a("line",{x1:"12",x2:"12",y1:"5",y2:"19"}),a("line",{x1:"5",x2:"19",y1:"12",y2:"12"})]})})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Ue(){const e=Ie(),{isPending:t,mutateAsync:s}=G({mutationFn:async l=>z("schedule",{...l},void 0,"POST"),onSuccess:()=>{e.invalidateQueries({queryKey:["all-schedules"]}),e.invalidateQueries({queryKey:["get-calendar-schedules"]})}});return{createSchedule:l=>s(l),createScheduleLoading:t}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Qe(){const{isPending:e,mutateAsync:t}=G({mutationFn:async s=>{if(!s.id)throw new Error("Schedule ID is undefined");return z(`schedule/${s.id}/update`,{...s},void 0,"POST")}});return{isUpdateScheduleLoading:e,updateSchedule:s=>t(s)}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Ve(){const[e,t]=x(W),{accounts:s}=Be(),l=u=>{t(g=>q(g,m=>{m.accounts={accountIds:u.accountIds,groupIds:u==null?void 0:u.groupIds}}))};return E.useEffect(()=>{l(e.accounts)},[]),s.length?c(Le,{gutter:20,children:[a(ae,{span:10,children:c(H,{children:[c(Me,{className:"mb-1",justify:"space-between",children:[a(U.Title,{level:5,children:L("Accounts")}),a(oe,{})]}),a(Ne,{selectedAccount:e.accounts,setSelectedAccount:l})]})}),a(ae,{span:14,children:a(Ae,{})})]}):c(H,{children:[a(Oe,{iconSize:40,textLevel:4}),a("div",{style:{textAlign:"center"},children:a(oe,{})})]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Ze(e){const{data:t,isLoading:s}=he({queryFn:async()=>z("categories",void 0,{postType:e},"GET"),queryKey:["categories",e]});return{categoriesAndTags:t==null?void 0:t.data,isLoadingCategories:s}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Ge(){const{isPending:e,mutateAsync:t}=G({mutationFn:async s=>z("filtered-posts",{...s},void 0,"POST")});return{loadingPostFilter:e,postFilter:s=>t(s)}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const{Title:Je}=U,Xe=[{label:"All times",value:"0"},{label:"Today",value:"1"},{label:"last 7 days",value:"7"},{label:"last 15 days",value:"15"},{label:"last 30 days",value:"30"},{label:"last 90 days",value:"90"},{label:"last 180 days",value:"180"},{label:"last 365 days",value:"365"},{label:"custom date range",value:"-1"}];function et(e,t){return t.label.toLowerCase().includes(e.toLowerCase())}const tt=(e,t)=>((t==null?void 0:t.label)??"").toLowerCase().includes(e.toLowerCase());function at(){const{token:e}=ue.useToken(),[t,s]=x(W),{RangePicker:l}=Ye,{loadingPostType:u,postTypes:g}=Re(),[m,w]=E.useState([]),{loadingPostFilter:d,postFilter:k}=Ge(),{categoriesAndTags:y,isLoadingCategories:T}=Ze(t.post_filters.post_type||""),{isProClient:P}=re(fe),A=be(Ce),$=g&&Object.values(g).map(o=>({label:c(H,{children:[o.label," ",o.name!=="post"&&!P&&a(_e,{color:"#ff8609",name:"crown",size:16})]}),value:o.name})),j=y?Object.keys(y).map(o=>({label:o,options:y[o].map(r=>({label:r.name,value:r.id}))})):[],i=(o,r)=>{s(D=>q(D,I=>{I.post_filters={...I.post_filters,[o]:r}}))},n=o=>r=>{if(o==="filter_by_days")if(r==="0")i("custom_date_range","");else{const D=_();let I=Number.parseInt(r,10);(r==="-1"||r==="1")&&(I=0);const Q=D.subtract(I,"day");i("custom_date_range",[Q.format("YYYY-MM-DD"),D.format("YYYY-MM-DD")])}if(!P&&o==="post_type"&&r!=="post"){A(!0);return}i(o,r)},f=o=>(r,D)=>{i("filter_by_days","-1"),i(o,D)},b=o=>{i("specific_postIds",o)},S=async()=>{const o=await k(t.post_filters);w((o==null?void 0:o.data)||[])};return E.useEffect(()=>{S()},[t.post_filters]),c(H,{children:[c(C,{layout:"vertical",children:[c(C.Item,{label:"By the published time of the posts",required:!0,children:[a(Y,{onChange:n("filter_by_days"),options:Xe,placeholder:"Select publish date",value:t.post_filters.filter_by_days}),t.post_filters.filter_by_days!=="0"&&t.post_filters.custom_date_range&&a(l,{allowClear:!1,onChange:f("custom_date_range"),style:{marginTop:8},value:[_(t.post_filters.custom_date_range[0],"YYYY-MM-DD"),_(t.post_filters.custom_date_range[1],"YYYY-MM-DD")]})]}),a(C.Item,{label:"By post type",children:a(Y,{allowClear:!0,loading:u,onChange:n("post_type"),options:$,placeholder:"Select post type",value:t.post_filters.post_type})}),a(C.Item,{label:"By the post category and tag",children:a(Y,{allowClear:!0,filterOption:tt,loading:T,onChange:n("categories_and_tags"),options:j,placeholder:"Select category or tag",showSearch:!0,value:t.post_filters.categories_and_tags})}),a(C.Item,{label:"Select Specific Post",children:a(Y,{allowClear:!0,filterOption:(o,r)=>r?et(o,r):!1,loading:d,mode:"multiple",onChange:b,options:m,placeholder:"Post ID: Post Title",showSearch:!0,style:{width:"100%"},value:t.post_filters.specific_postIds})})]}),c(Je,{css:pe({backgroundColor:e.colorBgElevated,bottom:0,marginBottom:"0 !important",paddingTop:6,position:"sticky"},"",""),level:5,children:[L("Posts matched by current filters"),": ",m==null?void 0:m.length]})]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const{Text:Z}=U,{dateFormat:st,timeFormat:ot,timeZone:R}=ie(ce),nt=`${st} ${ot}`,rt=ve(nt),ne=[{label:"Monday",value:"Mon"},{label:"Tuesday",value:"Tue"},{label:"Wednesday",value:"Wed"},{label:"Thursday",value:"Thu"},{label:"Friday",value:"Fri"},{label:"Saturday",value:"Sat"},{label:"Sunday",value:"Sun"}];var it={name:"z33n32",styles:"max-width:80px"},ct={name:"ypff5m",styles:"min-width:100px"};function lt(){var A,$,j;const[e,t]=x(W),s=ze(),[l,u]=x(le),[g,m]=de.useMessage(),w=_(K(R)).format("YYYY-MM-DD HH:mm:ss"),d=(i,n)=>{t(f=>q(f,b=>{b.settings={...b.settings,[i]:n}}))},k=i=>n=>{if(n&&_(n).diff(K(R))<1){u(b=>({...b,startedAt:"Start date & time must be grater than local time"}));return}const f=n==null?void 0:n.format("YYYY-MM-DD HH:mm:ss");if(f)return l.startedAt&&u(b=>({...b,startedAt:""})),d(i,f)},y=i=>n=>{if(i==="sleep_days"&&Array.isArray(n)&&ne.length===n.length){g.open({content:"Minimum one day required for post ",type:"warning"});return}d(i,n)},T=i=>{const{name:n,value:f}=i.target;d(n,f)},P=i=>(n,f)=>{if(n===void 0){t(b=>q(b,S=>{delete S.settings.sleep_time}));return}d(i,f)};return c(C,{layout:"vertical",children:[m,a(C.Item,{label:"Title",children:a(se,{name:"name",onChange:T,placeholder:"Enter a name",type:"text",value:(A=e.settings)==null?void 0:A.name})}),a(C.Item,{label:"Start date & time",children:c(O,{direction:"vertical",children:[a(Se,{onChangeDate:k,stateData:e,type:"SCHEDULE"}),l.startedAt&&c(Z,{type:"danger",children:[l.startedAt," "]}),a(Z,{mark:!0,children:Te(L("Local time: %s ; Time Zone: (%s)"),_(w).format(rt),R)})]})}),a(C.Item,{label:"Post interval",style:{margin:"10px 0"},children:c(O,{children:[a(se,{css:it,min:1,name:"post_interval_value",onChange:T,type:"number",value:e.settings.post_interval_value}),a(Y,{css:ct,onChange:y("post_interval_type"),options:s,value:e.settings.post_interval_type})]})}),e.id&&e.settings.started_at&&_(e.settings.started_at).diff(K(R))<1&&a(xe,{message:c(H,{children:[L("If your start time has passed, updating the interval will set your next post to local time plus the new interval! For example, current time 06:00 PM, updated Post interval: 2 hours. Next post will be at 08:00 PM."),a(U.Link,{href:"https://bit-social.com/docs/bit-social/schedule-wordpress-posts-on-social-media/#if-you-update-your-post-interval",rel:"noopener noreferrer",target:"_blank",underline:!0,children:L("Visit our documentation")})]}),showIcon:!0,type:"info"}),a(C.Item,{label:"Order posts by",children:a(Y,{onChange:y("post_publish_order"),options:[{label:"Randomly without duplicates",value:"1"},{label:"Randomly",value:"2"},{label:"Start from the oldest to new posts",value:"3"},{label:"Start from the latest to old posts",value:"4"}],value:e.settings.post_publish_order})}),a(C.Item,{children:c(O,{direction:"vertical",children:[a(O,{children:c(Z,{children:[" ",L("Set a sleep timer")," "]})}),a($e.RangePicker,{format:"HH:mm",onChange:P("sleep_time"),order:!1,value:($=e.settings.sleep_time)!=null&&$[0]&&((j=e.settings.sleep_time)!=null&&j[1])?[_(e.settings.sleep_time[0],"HH:mm"),_(e.settings.sleep_time[1],"HH:mm")]:void 0})]})}),a(C.Item,{label:"Set sleep days",children:a(Y,{allowClear:!0,mode:"multiple",onChange:y("sleep_days"),options:ne,placeholder:"Select sleep days",value:e.settings.sleep_days})})]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ht=[{children:a(lt,{}),key:"1",label:"Settings"},{children:a(at,{}),key:"2",label:"Post Filter"},{children:a(Ve,{}),key:"3",label:"Accounts & Template"}];function ut({handleTabActive:e,tabActive:t,token:s}){return a("div",{style:{paddingInline:24},children:a(Ee,{activeKey:t,className:"sticky-tab",css:pe({"& .ant-tabs-nav":{backgroundColor:s.colorBgElevated}},"",""),defaultActiveKey:"1",items:ht,onChange:e})})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};_.extend(we);_.extend(Pe);const{timeZone:dt}=ie(ce);function wt({btnTitle:e,isScheduleModalOpen:t,setIsScheduleModalOpen:s}){const{token:l}=ue.useToken(),[u,g]=x(W),m=E.useId(),[w,d]=E.useState("1"),{createSchedule:k,createScheduleLoading:y}=Ue(),{isUpdateScheduleLoading:T,updateSchedule:P}=Qe(),[A,$]=de.useMessage(),[j]=qe(),i=Number(j.get("page"))||1,n=Number(j.get("limit"))||10,[f]=x(De),{refetchSchedules:b}=Ke(f,i,n),{socialTemplates:S}=Fe(),o=re(ke),[r,D]=x(le);E.useEffect(()=>{!S||t.type!=="Create"||g(v=>q(v,F=>{Object.keys(F.templates).forEach(M=>{const h=S==null?void 0:S[M],p=F.templates[M],X=Object.keys(p).filter(N=>N!=="content"&&N!=="button"),ee=h==null?void 0:h.postingType;p.content=(h==null?void 0:h.content)||"",X.forEach(N=>{N in p&&(p[N]=!1)}),"comment"in p&&h&&"comment"in h&&(p.comment=h.comment||""),M==="googleBusinessProfile"&&"button"in p&&h&&"button"in h&&(p.button=h.button||"none"),M==="pinterest"&&"isLinkCard"in p&&h&&"isLinkCard"in h&&(p.isLinkCard=h.isLinkCard),X.includes(ee)&&(p[ee]=!0)})}))},[S,t.open]);const I=(v,F)=>{var B,M,h,p;return v.settings.name===""?(A.open({content:"name required",type:"error"}),!1):v.settings.started_at===""?(A.open({content:"start time required",type:"error"}),!1):!((B=v.accounts.accountIds)!=null&&B.length)&&!((h=(M=v.accounts)==null?void 0:M.groupIds)!=null&&h.length)?(A.open({content:"No account selected",type:"error"}),F("3"),!1):(p=r==null?void 0:r.startedAt)!=null&&p.length?(A.open({content:r.startedAt,type:"error"}),F("1"),!1):!0},Q=()=>{d("1");const v=_(K(dt)).format("YYYY-MM-DD HH:mm:ss");g(F=>q(F,B=>{B.settings.started_at=v})),s({open:!0,type:"Create"})},ge=async()=>{I(u,d)&&(await(u.id?P(u):k(u)),b(),s({open:!1,type:"Close"}),d("1"),g(te(o)))},J=()=>{d("1"),s({open:!1,type:"Close"}),D({}),g(te(o))},me=v=>{d(v)};return c(H,{children:[$,e&&a(V,{icon:a(We,{size:12}),onClick:Q,size:"large",type:"primary",children:e}),a(He,{centered:!0,confirmLoading:y||T,footer:c(O,{children:[a("div",{className:"pr-2",children:a(je,{type:"message"})}),a(V,{onClick:J,children:L("Cancel")},"back"),a(V,{loading:y||T,onClick:ge,type:"primary",children:u.id?"Update":"Create"},"Ok")]}),maskClosable:!1,onCancel:J,open:t.open,styles:{body:{marginInline:-24,maxHeight:"calc(100vh - 160px)",overflow:"auto"}},title:`${t==null?void 0:t.type} schedule`,width:w==="3"?800:600,children:a(ut,{handleTabActive:me,tabActive:w,token:l})},`hello ${m}`)]})}export{wt as C,Ke as u};
